import{n as e}from"./rolldown-runtime-A1xW-pDA.js";import{Dt as t,Ot as s,et as a,f as i,jt as r,q as n}from"./react-vendor-2hQaKJT0.js";import"./supabase-vendor-CLitCmdP.js";import{a as o,i as l,t as c}from"./index-4_19cBdp.js";import"./NotificationBell-DOonUTZz.js";import{t as d}from"./Layout-Dciw3jEd.js";import{t as m}from"./TaskForm-CYZZnEIZ.js";var u=e(r(),1),h=a(),x=e=>{if(!e)return"";if(/^\d{4}-\d{2}-\d{2}$/.test(e))return e;try{const t=new Date(e);return isNaN(t.getTime())?"":t.toISOString().split("T")[0]}catch{return""}};const p=()=>{const e=t(),{id:a}=s(),{isAdmin:r}=l(),[p,f]=(0,u.useState)(null),[g,j]=(0,u.useState)(!0),[v,y]=(0,u.useState)(!1),[w,b]=(0,u.useState)(!1);(0,u.useEffect)(()=>{k()},[a]);const k=async()=>{if(a)try{j(!0);const{data:{session:t}}=await o.auth.getSession();if(!t)return void e("/login");const s=await fetch(`http://localhost:3001/api/tasks/${a}`,{headers:{Authorization:`Bearer ${t.access_token}`}});if(!s.ok)throw new Error("Görev bulunamadı");f((await s.json()).data)}catch(t){alert("Görev yüklenirken bir hata oluştu"),e("/tasks")}finally{j(!1)}};return g?(0,h.jsx)(d,{children:(0,h.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,h.jsx)(c,{size:"lg",message:"Görev yükleniyor..."})})}):p?(0,h.jsx)(d,{children:(0,h.jsxs)("div",{className:"max-w-3xl mx-auto space-y-6",children:[(0,h.jsxs)("button",{onClick:()=>e(`/tasks/${a}`),className:"inline-flex items-center gap-2 text-sm text-slate-400 hover:text-white transition-colors [&>svg]:w-4 [&>svg]:h-4",children:[(0,h.jsx)(n,{className:"h-4 w-4"}),"Göreve Dön"]}),(0,h.jsxs)("div",{className:"flex items-center justify-between",children:[(0,h.jsxs)("div",{children:[(0,h.jsx)("h1",{className:"text-2xl sm:text-3xl font-bold text-white",children:"Görevi Düzenle"}),(0,h.jsx)("p",{className:"mt-1 text-slate-400",children:"Görev bilgilerini güncelleyin"})]}),r&&(0,h.jsxs)("button",{type:"button",onClick:t=>{t.preventDefault(),t.stopPropagation(),a&&setTimeout(async()=>{if(window.confirm("Bu görevi silmek istediğinizden emin misiniz? Bu işlem geri alınamaz."))try{b(!0);const{data:{session:t}}=await o.auth.getSession();if(!t)return void alert("Oturum bulunamadı");const s=await fetch(`http://localhost:3001/api/tasks/${a}`,{method:"DELETE",headers:{Authorization:`Bearer ${t.access_token}`}});if(!s.ok){const e=await s.json();throw new Error(e.message||"Görev silinemedi")}alert("Görev başarıyla silindi"),e("/tasks")}catch(t){alert(t instanceof Error?t.message:"Görev silinemedi")}finally{b(!1)}},0)},disabled:w,className:"inline-flex items-center gap-2 px-4 py-2 bg-red-600/20 border border-red-500/30 text-red-400 rounded-lg hover:bg-red-600/30 transition-colors disabled:opacity-50 cursor-pointer",children:[(0,h.jsx)(i,{className:"w-5 h-5 pointer-events-none"}),w?"Siliniyor...":"Görevi Sil"]})]}),(0,h.jsx)("div",{className:"glass-card p-6 rounded-xl",children:(0,h.jsx)(m,{initialData:{title:p.title,description:p.description,category:p.category,priority:p.priority,assigned_to:p.assigned_to,due_date:x(p.due_date),start_time:p.start_time,end_time:p.end_time,estimated_hours:p.estimated_hours,tags:p.tags},onSubmit:async t=>{if(a)try{y(!0);const{data:{session:s}}=await o.auth.getSession();if(!s)return void alert("Oturum bulunamadı");const i=await fetch(`http://localhost:3001/api/tasks/${a}`,{method:"PUT",headers:{Authorization:`Bearer ${s.access_token}`,"Content-Type":"application/json"},body:JSON.stringify(t)});if(!i.ok){const e=await i.json();throw new Error(e.message||"Görev güncellenemedi")}e(`/tasks/${a}`)}catch(s){alert(s instanceof Error?s.message:"Görev güncellenemedi")}finally{y(!1)}},onCancel:()=>e(`/tasks/${a}`),isLoading:v})})]})}):(0,h.jsx)(d,{children:(0,h.jsx)("div",{className:"text-center py-12",children:(0,h.jsx)("p",{className:"text-slate-400",children:"Görev bulunamadı"})})})};export{p as TaskEdit};