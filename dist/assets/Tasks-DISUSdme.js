import{n as e}from"./rolldown-runtime-A1xW-pDA.js";import{J as t,Tt as s,f as a,h as l,xt as r}from"./react-vendor-DnbmBACz.js";import"./supabase-vendor-CLitCmdP.js";import{i,n,r as o,t as d}from"./index-CDPVztAZ.js";import"./NotificationBell-DpekPiHl.js";import{t as c}from"./Layout-3NCdNaPA.js";import{n as m,t as x}from"./Modal-Dnx87MuO.js";import"./Input-CFqmQddI.js";import"./Card-Djhlbrke.js";import"./common-Cue6IpQD.js";import"./TaskDetail-DaScoys6.js";import"./TaskForm-m-m6Vi4S.js";var u=e(s(),1),h=t(),p={low:"bg-slate-500/20 text-slate-300",medium:"bg-blue-500/20 text-blue-400",high:"bg-orange-500/20 text-orange-400",critical:"bg-red-500/20 text-red-400"},j={not_started:"bg-slate-500/20 text-slate-300",in_progress:"bg-blue-500/20 text-blue-400",completed:"bg-emerald-500/20 text-emerald-400",blocked:"bg-red-500/20 text-red-400"},g={routine:"Rutin",project:"Proje",one_time:"Tek Seferlik",issue_resolution:"Sorun Çözümü"},v={not_started:"Başlamadı",in_progress:"Devam Ediyor",completed:"Tamamlandı",blocked:"Engellendi"};const b=({task:e,onClick:t,onDelete:s,showDeleteButton:l})=>{const r=e.due_date&&new Date(e.due_date)<new Date&&"completed"!==e.status;return(0,h.jsxs)("div",{onClick:t,className:n("glass-card p-5 rounded-xl cursor-pointer transition-all duration-300","hover:scale-[1.02] hover:shadow-xl hover:shadow-blue-500/10",r?"border-l-4 border-l-red-500":""),children:[(0,h.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,h.jsx)("h3",{className:"text-lg font-semibold text-white flex-1 pr-2",children:e.title}),(0,h.jsxs)("div",{className:"flex items-center gap-2",children:[(0,h.jsx)("span",{className:n("px-2.5 py-1 text-xs font-medium rounded-full",p[e.priority]),children:e.priority.toUpperCase()}),l&&s&&(0,h.jsx)("button",{onClick:s,className:"p-1.5 text-red-400 hover:bg-red-500/20 rounded-lg transition-colors",title:"Görevi Sil",children:(0,h.jsx)(a,{className:"w-4 h-4"})})]})]}),e.description&&(0,h.jsx)("p",{className:"text-sm text-slate-400 mb-4 line-clamp-2",children:e.description}),(0,h.jsxs)("div",{className:"flex flex-wrap gap-2 mb-4",children:[(0,h.jsx)("span",{className:n("px-2.5 py-1 text-xs font-medium rounded-full",j[e.status]),children:v[e.status]}),(0,h.jsx)("span",{className:"px-2.5 py-1 text-xs font-medium rounded-full bg-purple-500/20 text-purple-400",children:g[e.category]})]}),e.progress_percentage>0&&(0,h.jsxs)("div",{className:"mb-4",children:[(0,h.jsxs)("div",{className:"flex justify-between text-xs text-slate-400 mb-1",children:[(0,h.jsx)("span",{children:"İlerleme"}),(0,h.jsxs)("span",{className:"text-white font-medium",children:[e.progress_percentage,"%"]})]}),(0,h.jsx)("div",{className:"w-full bg-slate-700 rounded-full h-2 overflow-hidden",children:(0,h.jsx)("div",{className:"bg-gradient-to-r from-blue-500 to-emerald-500 h-2 rounded-full transition-all duration-500",style:{width:`${e.progress_percentage}%`}})})]}),(0,h.jsxs)("div",{className:"flex items-center justify-between text-xs text-slate-500",children:[e.due_date&&(0,h.jsxs)("div",{className:n("flex items-center gap-1",r?"text-red-400 font-medium":""),children:[(0,h.jsx)("svg",{className:"w-4 h-4 [&>path]:stroke-current",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,h.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),new Date(e.due_date).toLocaleDateString("tr-TR")]}),e.tags&&e.tags.length>0&&(0,h.jsxs)("div",{className:"flex gap-1",children:[e.tags.slice(0,2).map((e,t)=>(0,h.jsx)("span",{className:"px-2 py-0.5 bg-slate-700 text-slate-300 rounded text-xs",children:e},t)),e.tags.length>2&&(0,h.jsxs)("span",{className:"px-2 py-0.5 bg-slate-700 text-slate-300 rounded text-xs",children:["+",e.tags.length-2]})]})]})]})},f=({filters:e,onFilterChange:t})=>{const s=(s,a)=>{t({...e,[s]:a||void 0})},a="w-full bg-slate-800 border border-white/10 rounded-lg px-3 py-2 text-sm text-white focus:border-blue-500 focus:ring-1 focus:ring-blue-500 outline-none transition-colors",l="block text-sm font-medium text-slate-300 mb-1.5";return(0,h.jsxs)("div",{className:"glass-card p-5 rounded-xl mb-6",children:[(0,h.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:l,children:"Durum"}),(0,h.jsxs)("select",{value:e.status||"",onChange:e=>s("status",e.target.value),className:a,children:[(0,h.jsx)("option",{value:"",children:"Tümü"}),(0,h.jsx)("option",{value:"not_started",children:"Başlamadı"}),(0,h.jsx)("option",{value:"in_progress",children:"Devam Ediyor"}),(0,h.jsx)("option",{value:"completed",children:"Tamamlandı"}),(0,h.jsx)("option",{value:"blocked",children:"Engellendi"})]})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:l,children:"Kategori"}),(0,h.jsxs)("select",{value:e.category||"",onChange:e=>s("category",e.target.value),className:a,children:[(0,h.jsx)("option",{value:"",children:"Tümü"}),(0,h.jsx)("option",{value:"routine",children:"Rutin"}),(0,h.jsx)("option",{value:"project",children:"Proje"}),(0,h.jsx)("option",{value:"one_time",children:"Tek Seferlik"}),(0,h.jsx)("option",{value:"issue_resolution",children:"Sorun Çözümü"})]})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:l,children:"Öncelik"}),(0,h.jsxs)("select",{value:e.priority||"",onChange:e=>s("priority",e.target.value),className:a,children:[(0,h.jsx)("option",{value:"",children:"Tümü"}),(0,h.jsx)("option",{value:"low",children:"Düşük"}),(0,h.jsx)("option",{value:"medium",children:"Orta"}),(0,h.jsx)("option",{value:"high",children:"Yüksek"}),(0,h.jsx)("option",{value:"critical",children:"Kritik"})]})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:l,children:"Sırala"}),(0,h.jsxs)("select",{value:e.sort_by||"created_at",onChange:e=>s("sort_by",e.target.value),className:a,children:[(0,h.jsx)("option",{value:"created_at",children:"Oluşturma Tarihi"}),(0,h.jsx)("option",{value:"updated_at",children:"Güncelleme Tarihi"}),(0,h.jsx)("option",{value:"due_date",children:"Bitiş Tarihi"}),(0,h.jsx)("option",{value:"priority",children:"Öncelik"}),(0,h.jsx)("option",{value:"status",children:"Durum"}),(0,h.jsx)("option",{value:"title",children:"Başlık"})]})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:l,children:"Sıralama"}),(0,h.jsxs)("select",{value:e.sort_order||"desc",onChange:e=>s("sort_order",e.target.value),className:a,children:[(0,h.jsx)("option",{value:"desc",children:"Azalan"}),(0,h.jsx)("option",{value:"asc",children:"Artan"})]})]})]}),(0,h.jsx)("div",{className:"mt-4 flex justify-end",children:(0,h.jsx)("button",{onClick:()=>t({}),className:"text-sm text-blue-400 hover:text-blue-300 font-medium transition-colors",children:"Filtreleri Temizle"})})]})},y=()=>{const[e,t]=(0,u.useState)([]),[s,a]=(0,u.useState)(!0),[l,n]=(0,u.useState)(null),[c,m]=(0,u.useState)(null),[p,j]=(0,u.useState)(""),[g,v]=(0,u.useState)(!1),[y,N]=(0,u.useState)({sort_by:"created_at",sort_order:"desc"}),w=r(),{isAdmin:k}=o();(0,u.useEffect)(()=>{_()},[y]),(0,u.useEffect)(()=>{let e;return(async()=>{const{data:{session:s}}=await i.auth.getSession();s&&(e=i.channel("tasks-realtime").on("postgres_changes",{event:"*",schema:"public",table:"tasks"},e=>{"INSERT"===e.eventType?t(t=>[e.new,...t]):"UPDATE"===e.eventType?t(t=>t.map(t=>t.id===e.new.id?e.new:t)):"DELETE"===e.eventType&&t(t=>t.filter(t=>t.id!==e.old.id))}).subscribe())})(),()=>{e&&i.removeChannel(e)}},[]);const _=async()=>{try{a(!0),n(null);const{data:{session:e}}=await i.auth.getSession();if(!e)return void n("Oturum bulunamadı");const s=new URLSearchParams;y.status&&s.append("status",y.status),y.category&&s.append("category",y.category),y.priority&&s.append("priority",y.priority),y.sort_by&&s.append("sort_by",y.sort_by),y.sort_order&&s.append("sort_order",y.sort_order);const l=await fetch(`http://localhost:3001/api/tasks?${s.toString()}`,{headers:{Authorization:`Bearer ${e.access_token}`,"Content-Type":"application/json"}});if(!l.ok)throw new Error("Görevler yüklenemedi");t((await l.json()).data||[])}catch(e){n(e instanceof Error?e.message:"Bir hata oluştu")}finally{a(!1)}};return s?(0,h.jsx)("div",{className:"flex justify-center items-center min-h-[400px]",children:(0,h.jsx)(d,{size:"lg",message:"Görevler yükleniyor..."})}):l?(0,h.jsxs)("div",{className:"glass-card p-6 rounded-xl border-red-500/30",children:[(0,h.jsx)("p",{className:"font-medium text-red-400",children:"Hata"}),(0,h.jsx)("p",{className:"text-sm text-slate-400 mt-1",children:l}),(0,h.jsx)("button",{onClick:_,className:"mt-3 text-sm text-blue-400 hover:text-blue-300 font-medium transition-colors",children:"Tekrar Dene"})]}):(0,h.jsxs)("div",{children:[(0,h.jsx)(f,{filters:y,onFilterChange:N}),0===e.length?(0,h.jsxs)("div",{className:"glass-card p-10 rounded-xl text-center",children:[(0,h.jsx)("svg",{className:"mx-auto h-12 w-12 text-slate-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,h.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})}),(0,h.jsx)("h3",{className:"mt-3 text-base font-medium text-white",children:"Görev bulunamadı"}),(0,h.jsx)("p",{className:"mt-1 text-sm text-slate-400",children:"Seçili filtrelere uygun görev bulunmuyor."})]}):(0,h.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:e.map(e=>(0,h.jsx)(b,{task:e,onClick:()=>{return t=e.id,void w(`/tasks/${t}`);var t},onDelete:k?t=>((e,t)=>{e.stopPropagation(),m(t.id),j(t.title)})(t,e):void 0,showDeleteButton:k},e.id))}),(0,h.jsx)(x,{isOpen:!!c,onClose:()=>m(null),title:"Görevi Sil",children:(0,h.jsxs)("div",{className:"space-y-4",children:[(0,h.jsxs)("p",{className:"text-slate-300",children:[(0,h.jsx)("strong",{className:"text-white",children:p})," görevini silmek istediğinize emin misiniz?"]}),(0,h.jsx)("p",{className:"text-sm text-red-400",children:"Bu işlem geri alınamaz."}),(0,h.jsxs)("div",{className:"flex justify-end gap-3 pt-2",children:[(0,h.jsx)("button",{onClick:()=>m(null),disabled:g,className:"px-4 py-2 text-sm font-medium text-slate-300 hover:text-white transition-colors",children:"İptal"}),(0,h.jsx)("button",{onClick:async()=>{if(c)try{v(!0);const{data:{session:s}}=await i.auth.getSession();if(!s)return void alert("Oturum bulunamadı");const a=await fetch(`http://localhost:3001/api/tasks/${c}`,{method:"DELETE",headers:{Authorization:`Bearer ${s.access_token}`}});if(!a.ok){const e=await a.json();throw new Error(e.message||"Görev silinemedi")}t(e.filter(e=>e.id!==c)),m(null)}catch(s){alert(s instanceof Error?s.message:"Silme başarısız")}finally{v(!1)}},disabled:g,className:"px-4 py-2 text-sm font-semibold text-white bg-red-600 hover:bg-red-500 rounded-lg transition-all disabled:opacity-50",children:g?"Siliniyor...":"Evet, Sil"})]})]})})]})},N=()=>{const e=r(),{isAdmin:t}=o();return(0,h.jsx)(c,{children:(0,h.jsxs)("div",{className:"space-y-6",children:[(0,h.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[(0,h.jsxs)("div",{children:[(0,h.jsx)("h1",{className:"text-2xl sm:text-3xl font-bold text-white",children:"Görevler"}),(0,h.jsx)("p",{className:"mt-1 text-slate-400",children:t?"Tüm görevleri yönetin ve atayın":"Kendi görevlerinizi yönetin"})]}),(0,h.jsxs)(m,{onClick:()=>e("/tasks/new"),className:"inline-flex items-center gap-2 px-5 py-2.5 text-sm font-semibold text-white bg-gradient-to-r from-blue-600 to-purple-600 rounded-xl hover:from-blue-500 hover:to-purple-500 hover:shadow-lg hover:shadow-blue-500/25 hover:-translate-y-0.5 transition-all duration-200 [&>svg]:w-5 [&>svg]:h-5",children:[(0,h.jsx)(l,{className:"h-5 w-5"}),t?"Yeni Görev":"Kendime Görev Ekle"]})]}),(0,h.jsx)(y,{})]})})};export{N as Tasks};