import{C as e,E as s,J as t,S as l,Tt as a,_ as r,c as i,f as n,h as o,l as d,m as c,o as m}from"./react-vendor-DnbmBACz.js";import"./supabase-vendor-CLitCmdP.js";import{i as u,r as x,t as h}from"./index-CDPVztAZ.js";import"./NotificationBell-DpekPiHl.js";import{t as p}from"./Layout-3NCdNaPA.js";import{t as b}from"./Modal-Dnx87MuO.js";import"./Input-CFqmQddI.js";import"./Card-Djhlbrke.js";import"./common-Cue6IpQD.js";var f=a(),j=t();const g=({isOpen:s,onClose:t,onUserCreated:a})=>{const[r,i]=(0,f.useState)(!1),[n,o]=(0,f.useState)(null),[c,x]=(0,f.useState)(!1),[h,p]=(0,f.useState)({email:"",password:"",full_name:"",role:"employee",department:""}),b=e=>{const{name:s,value:t}=e.target;p(e=>({...e,[s]:t})),o(null)};return s?(0,j.jsxs)("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:[(0,j.jsx)("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm",onClick:t}),(0,j.jsx)("div",{className:"flex min-h-full items-center justify-center p-4",children:(0,j.jsxs)("div",{className:"relative w-full max-w-md transform rounded-2xl bg-slate-900 border border-white/10 p-6 shadow-xl transition-all",children:[(0,j.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,j.jsxs)("div",{className:"flex items-center gap-3",children:[(0,j.jsx)("div",{className:"p-2 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl",children:(0,j.jsx)(d,{className:"w-6 h-6 text-white"})}),(0,j.jsx)("h2",{className:"text-xl font-bold text-white",children:"Yeni Kullanıcı Oluştur"})]}),(0,j.jsx)("button",{onClick:t,className:"p-2 rounded-lg hover:bg-white/10 transition-colors",children:(0,j.jsx)(m,{className:"w-5 h-5 text-slate-400"})})]}),n&&(0,j.jsx)("div",{className:"mb-4 p-3 bg-red-500/10 border border-red-500/20 rounded-lg",children:(0,j.jsx)("p",{className:"text-sm text-red-400",children:n})}),(0,j.jsxs)("form",{onSubmit:async e=>{e.preventDefault(),i(!0),o(null);try{const{data:{session:e}}=await u.auth.getSession();if(!e)throw new Error("Oturum bulunamadı");const s=await fetch("http://localhost:3001/api/users/create",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e?.access_token}`},body:JSON.stringify(h)}),l=await s.json();if(!s.ok)throw new Error(l.message||"Kullanıcı oluşturulamadı");p({email:"",password:"",full_name:"",role:"employee",department:""}),a(),t()}catch(s){o(s instanceof Error?s.message:"Bir hata oluştu")}finally{i(!1)}},className:"space-y-4",children:[(0,j.jsxs)("div",{children:[(0,j.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-1.5",children:"Ad Soyad *"}),(0,j.jsx)("input",{type:"text",name:"full_name",value:h.full_name,onChange:b,required:!0,placeholder:"Örn: Ahmet Yılmaz",className:"w-full px-4 py-2.5 bg-slate-800 border border-white/10 rounded-lg text-white placeholder-slate-500 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 outline-none transition-colors"})]}),(0,j.jsxs)("div",{children:[(0,j.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-1.5",children:"Email *"}),(0,j.jsx)("input",{type:"email",name:"email",value:h.email,onChange:b,required:!0,placeholder:"ornek@sirket.com",className:"w-full px-4 py-2.5 bg-slate-800 border border-white/10 rounded-lg text-white placeholder-slate-500 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 outline-none transition-colors"})]}),(0,j.jsxs)("div",{children:[(0,j.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-1.5",children:"Şifre *"}),(0,j.jsxs)("div",{className:"relative",children:[(0,j.jsx)("input",{type:c?"text":"password",name:"password",value:h.password,onChange:b,required:!0,minLength:6,placeholder:"En az 6 karakter",className:"w-full px-4 py-2.5 pr-12 bg-slate-800 border border-white/10 rounded-lg text-white placeholder-slate-500 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 outline-none transition-colors"}),(0,j.jsx)("button",{type:"button",onClick:()=>x(!c),className:"absolute right-3 top-1/2 -translate-y-1/2 p-1 hover:bg-white/10 rounded transition-colors",children:c?(0,j.jsx)(e,{className:"w-5 h-5 text-slate-400"}):(0,j.jsx)(l,{className:"w-5 h-5 text-slate-400"})})]})]}),(0,j.jsxs)("div",{children:[(0,j.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-1.5",children:"Rol"}),(0,j.jsxs)("select",{name:"role",value:h.role,onChange:b,className:"w-full px-4 py-2.5 bg-slate-800 border border-white/10 rounded-lg text-white focus:border-blue-500 focus:ring-1 focus:ring-blue-500 outline-none transition-colors",children:[(0,j.jsx)("option",{value:"employee",children:"Çalışan"}),(0,j.jsx)("option",{value:"admin",children:"Admin"})]})]}),(0,j.jsxs)("div",{children:[(0,j.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-1.5",children:"Departman"}),(0,j.jsx)("input",{type:"text",name:"department",value:h.department,onChange:b,placeholder:"Örn: Satış, Muhasebe, IT",className:"w-full px-4 py-2.5 bg-slate-800 border border-white/10 rounded-lg text-white placeholder-slate-500 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 outline-none transition-colors"})]}),(0,j.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,j.jsx)("button",{type:"button",onClick:t,className:"flex-1 px-4 py-2.5 bg-slate-800 border border-white/10 rounded-lg text-white font-medium hover:bg-slate-700 transition-colors",children:"İptal"}),(0,j.jsx)("button",{type:"submit",disabled:r,className:"flex-1 px-4 py-2.5 bg-gradient-to-r from-blue-600 to-purple-600 rounded-lg text-white font-medium hover:from-blue-500 hover:to-purple-500 disabled:opacity-50 disabled:cursor-not-allowed transition-all",children:r?"Oluşturuluyor...":"Oluştur"})]})]})]})})]}):null},w=()=>{const{isAdmin:e}=x(),[t,l]=(0,f.useState)([]),[a,d]=(0,f.useState)(!0),[m,w]=(0,f.useState)(""),[v,N]=(0,f.useState)("all"),[y,k]=(0,f.useState)(!1),[C,S]=(0,f.useState)(null),[_,E]=(0,f.useState)(""),[z,A]=(0,f.useState)(!1);(0,f.useEffect)(()=>{K()},[]);const K=async()=>{try{d(!0);const{data:e,error:s}=await u.from("profiles").select("*").order("full_name",{ascending:!0});if(s)throw s;l(e||[])}catch(e){}finally{d(!1)}},O=t.filter(e=>{const s=e.full_name?.toLowerCase().includes(m.toLowerCase())||e.email?.toLowerCase().includes(m.toLowerCase()),t="all"===v||e.role===v;return s&&t}),T={admin:"bg-purple-500/20 text-purple-400",employee:"bg-blue-500/20 text-blue-400"};return e?(0,j.jsxs)(p,{children:[(0,j.jsxs)("div",{className:"space-y-6",children:[(0,j.jsxs)("div",{className:"flex items-center justify-between",children:[(0,j.jsxs)("div",{children:[(0,j.jsx)("h1",{className:"text-2xl font-bold text-white",children:"Kullanıcı Yönetimi"}),(0,j.jsx)("p",{className:"mt-1 text-sm text-slate-400",children:"Tüm kullanıcıları görüntüleyin ve rollerini yönetin"})]}),(0,j.jsxs)("div",{className:"flex items-center gap-4",children:[(0,j.jsxs)("div",{className:"text-right",children:[(0,j.jsx)("p",{className:"text-2xl font-bold text-white",children:t.length}),(0,j.jsx)("p",{className:"text-sm text-slate-400",children:"Toplam Kullanıcı"})]}),(0,j.jsxs)("button",{onClick:()=>k(!0),className:"flex items-center gap-2 px-4 py-2.5 bg-gradient-to-r from-blue-600 to-purple-600 rounded-xl text-white font-medium hover:from-blue-500 hover:to-purple-500 hover:shadow-lg hover:shadow-blue-500/25 transition-all",children:[(0,j.jsx)(o,{className:"w-5 h-5"}),"Yeni Kullanıcı"]})]})]}),(0,j.jsx)("div",{className:"glass-card p-4",children:(0,j.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4",children:[(0,j.jsxs)("div",{className:"relative flex-1",children:[(0,j.jsx)(r,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"}),(0,j.jsx)("input",{type:"text",placeholder:"İsim veya email ara...",value:m,onChange:e=>w(e.target.value),className:"w-full pl-10 pr-4 py-2.5 bg-slate-800 border border-white/10 rounded-lg text-white placeholder-slate-500 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 outline-none transition-colors"})]}),(0,j.jsxs)("select",{value:v,onChange:e=>N(e.target.value),className:"px-4 py-2.5 bg-slate-800 border border-white/10 rounded-lg text-white focus:border-blue-500 focus:ring-1 focus:ring-blue-500 outline-none transition-colors",children:[(0,j.jsx)("option",{value:"all",children:"Tüm Roller"}),(0,j.jsx)("option",{value:"admin",children:"Admin"}),(0,j.jsx)("option",{value:"employee",children:"Çalışan"})]})]})}),a?(0,j.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,j.jsx)(h,{size:"lg"})}):0===O.length?(0,j.jsxs)("div",{className:"glass-card p-8 text-center",children:[(0,j.jsx)(i,{className:"w-12 h-12 text-slate-500 mx-auto mb-4"}),(0,j.jsx)("p",{className:"text-slate-400",children:"Kullanıcı bulunamadı"})]}):(0,j.jsx)("div",{className:"glass-card overflow-hidden",children:(0,j.jsx)("div",{className:"divide-y divide-white/5",children:O.map(e=>(0,j.jsx)("div",{className:"p-4 hover:bg-white/5 transition-colors",children:(0,j.jsxs)("div",{className:"flex items-center justify-between",children:[(0,j.jsxs)("div",{className:"flex items-center gap-4",children:[e.avatar_url?(0,j.jsx)("img",{src:e.avatar_url,alt:e.full_name,className:"w-12 h-12 rounded-xl object-cover border border-white/10"}):(0,j.jsx)("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center",children:(0,j.jsx)("span",{className:"text-lg font-bold text-white",children:e.full_name?.charAt(0).toUpperCase()||"?"})}),(0,j.jsxs)("div",{children:[(0,j.jsx)("h3",{className:"text-white font-medium",children:e.full_name}),(0,j.jsxs)("div",{className:"flex items-center gap-2 text-sm text-slate-400",children:[(0,j.jsx)(s,{className:"w-4 h-4"}),e.email]}),e.department&&(0,j.jsx)("p",{className:"text-xs text-slate-500 mt-0.5",children:e.department})]})]}),(0,j.jsxs)("div",{className:"flex items-center gap-4",children:[(0,j.jsx)("span",{className:`px-3 py-1 text-xs font-semibold rounded-full ${T[e.role]||T.employee}`,children:"admin"===e.role?"Admin":"Çalışan"}),(0,j.jsxs)("select",{value:e.role,onChange:s=>(async(e,s)=>{try{const{error:a}=await u.from("profiles").update({role:s}).eq("id",e);if(a)throw a;l(t.map(t=>t.id===e?{...t,role:s}:t))}catch(a){}})(e.id,s.target.value),className:"px-3 py-1.5 bg-slate-800 border border-white/10 rounded-lg text-sm text-white focus:border-blue-500 outline-none",children:[(0,j.jsx)("option",{value:"employee",children:"Çalışan"}),(0,j.jsx)("option",{value:"admin",children:"Admin"})]}),(0,j.jsx)("button",{onClick:()=>{S(e.id),E(e.full_name)},className:"p-2 text-red-400 hover:bg-red-500/20 rounded-lg transition-colors",title:"Kullanıcıyı Sil",children:(0,j.jsx)(n,{className:"w-5 h-5"})})]})]})},e.id))})})]}),(0,j.jsx)(g,{isOpen:y,onClose:()=>k(!1),onUserCreated:K}),(0,j.jsx)(b,{isOpen:!!C,onClose:()=>S(null),title:"Kullanıcıyı Sil",children:(0,j.jsxs)("div",{className:"space-y-4",children:[(0,j.jsxs)("p",{className:"text-slate-300",children:[(0,j.jsx)("strong",{className:"text-white",children:_})," kullanıcısını silmek istediğinize emin misiniz?"]}),(0,j.jsx)("p",{className:"text-sm text-red-400",children:"Bu işlem geri alınamaz. Kullanıcının tüm verileri silinecektir."}),(0,j.jsxs)("div",{className:"flex justify-end gap-3 pt-2",children:[(0,j.jsx)("button",{onClick:()=>S(null),disabled:z,className:"px-4 py-2 text-sm font-medium text-slate-300 hover:text-white transition-colors",children:"İptal"}),(0,j.jsx)("button",{onClick:async()=>{if(C)try{A(!0);const{data:{session:e}}=await u.auth.getSession();if(!e)return void alert("Oturum bulunamadı");const s=await fetch(`http://localhost:3001/api/users/${C}`,{method:"DELETE",headers:{Authorization:`Bearer ${e.access_token}`}});if(!s.ok){const e=await s.json();throw new Error(e.message||"Kullanıcı silinemedi")}l(t.filter(e=>e.id!==C)),S(null)}catch(e){alert(e instanceof Error?e.message:"Silme başarısız")}finally{A(!1)}},disabled:z,className:"px-4 py-2 text-sm font-semibold text-white bg-red-600 hover:bg-red-500 rounded-lg transition-all disabled:opacity-50",children:z?"Siliniyor...":"Evet, Sil"})]})]})})]}):(0,j.jsx)(p,{children:(0,j.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,j.jsxs)("div",{className:"glass-card p-8 text-center",children:[(0,j.jsx)(c,{className:"w-12 h-12 text-red-400 mx-auto mb-4"}),(0,j.jsx)("h2",{className:"text-xl font-semibold text-white mb-2",children:"Yetkisiz Erişim"}),(0,j.jsx)("p",{className:"text-slate-400",children:"Bu sayfayı görüntüleme yetkiniz yok."})]})})})};export{w as Users};