import{n as e}from"./rolldown-runtime-A1xW-pDA.js";import{J as s,Tt as t,xt as i}from"./react-vendor-DnbmBACz.js";import"./supabase-vendor-CLitCmdP.js";import{i as n,r as a}from"./index-CDPVztAZ.js";import{t as o}from"./NotificationBell-DpekPiHl.js";import"./Modal-Dnx87MuO.js";import"./Input-CFqmQddI.js";import{n as r,t as l}from"./issues-BFhsayCm.js";var c=t();var d=s();const m=()=>{const{isAdmin:e}=a(),s=i(),{newIssueCount:t,clearNotifications:m}=(()=>{const[e,s]=(0,c.useState)(0);return(0,c.useEffect)(()=>{"Notification"in window&&"default"===Notification.permission&&Notification.requestPermission();const e=n.channel("admin-issue-notifications").on("postgres_changes",{event:"INSERT",schema:"public",table:"issues"},e=>{const t=e.new;if(s(e=>e+1),"Notification"in window&&"granted"===Notification.permission){const e=new Notification("Yeni Sorun Bildirimi",{body:`${t.title}`,icon:"/icon-192x192.png",badge:"/badge-72x72.png",tag:`issue-${t.id}`,requireInteraction:!1,silent:!1});e.onclick=()=>{window.focus(),e.close()},setTimeout(()=>e.close(),5e3)}}).subscribe();return()=>{n.removeChannel(e)}},[]),{newIssueCount:e,clearNotifications:()=>{s(0)}}})(),[h,x]=(0,c.useState)([]),[u,g]=(0,c.useState)(!0),[f,j]=(0,c.useState)(null),[p,N]=(0,c.useState)(!1);(0,c.useEffect)(()=>{if(!e)return void s("/dashboard");v();const t=n.channel("admin-issues-changes").on("postgres_changes",{event:"*",schema:"public",table:"issues"},e=>{v()}).subscribe();return()=>{n.removeChannel(t)}},[e,s]);const v=async()=>{try{g(!0);const{data:{session:e}}=await n.auth.getSession();if(!e)return void s("/login");const t=await fetch("http://localhost:3001/api/issues",{headers:{Authorization:`Bearer ${e.access_token}`}});if(!t.ok)throw new Error("Failed to fetch issues");x((await t.json()).data||[])}catch(e){}finally{g(!1)}},w=h.filter(e=>"pending_assignment"===e.status),b=h.filter(e=>"pending_assignment"!==e.status);return(0,d.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,d.jsx)("div",{className:"mb-8",children:(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Sorun Yönetimi"}),(0,d.jsx)("p",{className:"mt-2 text-sm text-gray-600",children:"Bildirilen sorunları inceleyin ve görev olarak atayın"})]}),(0,d.jsx)(o,{count:t,onClick:m})]})}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[(0,d.jsx)("div",{className:"bg-white rounded-lg shadow p-6",children:(0,d.jsxs)("div",{className:"flex items-center",children:[(0,d.jsx)("div",{className:"flex-shrink-0",children:(0,d.jsx)("div",{className:"w-12 h-12 bg-yellow-100 rounded-lg flex items-center justify-center",children:(0,d.jsx)("svg",{className:"w-6 h-6 text-yellow-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})})})}),(0,d.jsxs)("div",{className:"ml-4",children:[(0,d.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Bekleyen"}),(0,d.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:w.length})]})]})}),(0,d.jsx)("div",{className:"bg-white rounded-lg shadow p-6",children:(0,d.jsxs)("div",{className:"flex items-center",children:[(0,d.jsx)("div",{className:"flex-shrink-0",children:(0,d.jsx)("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center",children:(0,d.jsx)("svg",{className:"w-6 h-6 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})})})}),(0,d.jsxs)("div",{className:"ml-4",children:[(0,d.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Atandı"}),(0,d.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:b.length})]})]})}),(0,d.jsx)("div",{className:"bg-white rounded-lg shadow p-6",children:(0,d.jsxs)("div",{className:"flex items-center",children:[(0,d.jsx)("div",{className:"flex-shrink-0",children:(0,d.jsx)("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:(0,d.jsx)("svg",{className:"w-6 h-6 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})})}),(0,d.jsxs)("div",{className:"ml-4",children:[(0,d.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Toplam"}),(0,d.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:h.length})]})]})})]}),w.length>0&&(0,d.jsxs)("div",{className:"mb-8",children:[(0,d.jsxs)("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:["Atama Bekleyen Sorunlar (",w.length,")"]}),(0,d.jsx)(r,{issues:w,loading:u&&0===h.length,showActions:!0,onAssign:e=>{j(e),N(!0)},emptyMessage:"Atama bekleyen sorun yok"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Tüm Sorunlar"}),(0,d.jsx)(r,{issues:h,loading:u,emptyMessage:"Henüz sorun bildirimi yok"})]}),f&&(0,d.jsx)(l,{issue:f,isOpen:p,onClose:()=>{N(!1),j(null)},onAssign:async(e,t)=>{try{const{data:{session:i}}=await n.auth.getSession();if(!i)return void s("/login");const a=await fetch(`http://localhost:3001/api/issues/${e}/assign`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i.access_token}`},body:JSON.stringify(t)});if(!a.ok){const e=await a.json();throw new Error(e.message||"Failed to assign issue")}await a.json(),N(!1),j(null),v()}catch(i){throw i}}})]})};export{m as AdminIssues};