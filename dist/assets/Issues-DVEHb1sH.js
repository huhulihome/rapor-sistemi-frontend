import{n as s}from"./rolldown-runtime-A1xW-pDA.js";import{Dt as e,et as t,g as i,jt as a}from"./react-vendor-2hQaKJT0.js";import"./supabase-vendor-CLitCmdP.js";import{a as o,i as n}from"./index-4_19cBdp.js";import"./NotificationBell-DOonUTZz.js";import{t as r}from"./Layout-Dciw3jEd.js";import{n as l,t as c}from"./Modal-BBpZSCNt.js";import"./Input-BaavD_GS.js";import{n as h,r as d,t as u}from"./issues-B4w_OaE_.js";var m=s(a(),1),p=t();const f=()=>{const s=e(),{isAdmin:t}=n(),[a,f]=(0,m.useState)([]),[g,j]=(0,m.useState)(!0),[x,w]=(0,m.useState)(!1),[v,y]=(0,m.useState)(null),[b,S]=(0,m.useState)(!1);(0,m.useEffect)(()=>{k();const s=o.channel("issues-changes").on("postgres_changes",{event:"*",schema:"public",table:"issues"},()=>{k()}).subscribe();return()=>{o.removeChannel(s)}},[]);const k=async()=>{try{j(!0);const{data:{session:e}}=await o.auth.getSession();if(!e)return void s("/login");const t=await fetch("http://localhost:3001/api/issues",{headers:{Authorization:`Bearer ${e.access_token}`}});if(!t.ok)throw new Error("Failed to fetch issues");f((await t.json()).data||[])}catch(e){}finally{j(!1)}};return(0,p.jsx)(r,{children:(0,p.jsxs)("div",{className:"space-y-6",children:[(0,p.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[(0,p.jsxs)("div",{children:[(0,p.jsx)("h1",{className:"text-2xl sm:text-3xl font-bold text-white",children:"Sorun Bildirimleri"}),(0,p.jsx)("p",{className:"mt-1 text-slate-400",children:"Karşılaştığınız sorunları bildirin ve çözüm sürecini takip edin"})]}),(0,p.jsxs)(l,{variant:"primary",onClick:()=>w(!0),className:"inline-flex items-center gap-2 px-5 py-2.5 text-sm font-semibold text-white bg-gradient-to-r from-red-600 to-orange-600 rounded-xl hover:from-red-500 hover:to-orange-500 hover:shadow-lg hover:shadow-red-500/25 hover:-translate-y-0.5 transition-all duration-200 [&>svg]:w-5 [&>svg]:h-5",children:[(0,p.jsx)(i,{className:"h-5 w-5"}),"Yeni Sorun Bildir"]})]}),(0,p.jsx)(h,{issues:a,loading:g,showActions:t,onAssign:t?s=>{y(s),S(!0)}:void 0,onIssueClick:s=>{},emptyMessage:"Henüz sorun bildirimi yok. İlk sorunu siz bildirin!"}),(0,p.jsx)(c,{isOpen:x,onClose:()=>w(!1),title:"Yeni Sorun Bildir",children:(0,p.jsx)(d,{onSubmit:async e=>{try{const{data:{session:t}}=await o.auth.getSession();if(!t)return void s("/login");const i=await fetch("http://localhost:3001/api/issues",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t.access_token}`},body:JSON.stringify(e)});if(!i.ok){const s=await i.json();throw new Error(s.message||"Failed to create issue")}w(!1),k()}catch(t){throw t}},onCancel:()=>w(!1)})}),t&&v&&(0,p.jsx)(u,{issue:v,isOpen:b,onClose:()=>{S(!1),y(null)},onAssign:async(e,t)=>{try{const{data:{session:i}}=await o.auth.getSession();if(!i)return void s("/login");const a=await fetch(`http://localhost:3001/api/issues/${e}/assign`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i.access_token}`},body:JSON.stringify(t)});if(!a.ok){const s=await a.json();throw new Error(s.message||"Atama başarısız")}S(!1),y(null),k()}catch(i){throw i}}})]})})};export{f as Issues};