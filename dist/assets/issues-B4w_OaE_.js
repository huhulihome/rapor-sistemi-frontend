import{n as e}from"./rolldown-runtime-A1xW-pDA.js";import{et as s,jt as t}from"./react-vendor-2hQaKJT0.js";import{a as i,r as a,t as l}from"./index-4_19cBdp.js";import{n as r,t as n}from"./Modal-BBpZSCNt.js";import{t as d}from"./Input-BaavD_GS.js";var o=e(t(),1),c=s();const m=({onSubmit:e,onCancel:s})=>{const[t,a]=(0,o.useState)({title:"",description:"",priority:"medium",suggested_assignee_id:""}),[l,r]=(0,o.useState)([]),[n,d]=(0,o.useState)(!1),[m,u]=(0,o.useState)(!0),[x,h]=(0,o.useState)(null);(0,o.useEffect)(()=>{p()},[]);const p=async()=>{try{u(!0);const{data:e,error:s}=await i.from("profiles").select("id, full_name, email, department").order("full_name");if(s)throw s;r(e||[])}catch(e){h("Çalışanlar yüklenirken hata oluştu")}finally{u(!1)}},g=e=>{const{name:s,value:t}=e.target;a(e=>({...e,[s]:t}))},b="w-full bg-slate-800 border border-white/10 rounded-lg px-3 py-2.5 text-white placeholder-slate-500 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 outline-none transition-colors disabled:opacity-50 disabled:cursor-not-allowed",f="block text-sm font-medium text-slate-300 mb-2";return(0,c.jsxs)("form",{onSubmit:async s=>{if(s.preventDefault(),h(null),t.title.trim())if(t.description.trim())if(t.suggested_assignee_id)try{d(!0),await e(t),a({title:"",description:"",priority:"medium",suggested_assignee_id:""})}catch(i){h(i instanceof Error?i.message:"Sorun bildirilirken hata oluştu")}finally{d(!1)}else h("Lütfen önerilen çözüm sorumlusunu seçin");else h("Sorun açıklaması gereklidir");else h("Sorun başlığı gereklidir")},className:"space-y-5",children:[x&&(0,c.jsx)("div",{className:"bg-red-500/10 border border-red-500/30 text-red-400 px-4 py-3 rounded-lg text-sm",children:x}),(0,c.jsxs)("div",{children:[(0,c.jsxs)("label",{htmlFor:"title",className:f,children:["Sorun Başlığı ",(0,c.jsx)("span",{className:"text-red-400",children:"*"})]}),(0,c.jsx)("input",{id:"title",name:"title",type:"text",value:t.title,onChange:g,placeholder:"Sorunun kısa bir özeti",required:!0,disabled:n,className:b})]}),(0,c.jsxs)("div",{children:[(0,c.jsxs)("label",{htmlFor:"description",className:f,children:["Sorun Açıklaması ",(0,c.jsx)("span",{className:"text-red-400",children:"*"})]}),(0,c.jsx)("textarea",{id:"description",name:"description",value:t.description,onChange:g,placeholder:"Sorunun detaylı açıklaması...",required:!0,disabled:n,rows:5,className:b})]}),(0,c.jsxs)("div",{children:[(0,c.jsxs)("label",{htmlFor:"priority",className:f,children:["Öncelik ",(0,c.jsx)("span",{className:"text-red-400",children:"*"})]}),(0,c.jsxs)("select",{id:"priority",name:"priority",value:t.priority,onChange:g,required:!0,disabled:n,className:b,children:[(0,c.jsx)("option",{value:"low",children:"Düşük"}),(0,c.jsx)("option",{value:"medium",children:"Orta"}),(0,c.jsx)("option",{value:"high",children:"Yüksek"}),(0,c.jsx)("option",{value:"critical",children:"Kritik"})]})]}),(0,c.jsxs)("div",{children:[(0,c.jsxs)("label",{htmlFor:"suggested_assignee_id",className:f,children:["Çözebileceğini Düşündüğünüz Kişi ",(0,c.jsx)("span",{className:"text-red-400",children:"*"})]}),m?(0,c.jsx)("div",{className:"text-sm text-slate-500",children:"Çalışanlar yükleniyor..."}):(0,c.jsxs)("select",{id:"suggested_assignee_id",name:"suggested_assignee_id",value:t.suggested_assignee_id,onChange:g,required:!0,disabled:n,className:b,children:[(0,c.jsx)("option",{value:"",children:"Kişi seçin..."}),l.map(e=>(0,c.jsxs)("option",{value:e.id,children:[e.full_name," ",e.department?`(${e.department})`:""]},e.id))]}),(0,c.jsx)("p",{className:"mt-1.5 text-xs text-slate-500",children:"Bu sorunun çözümünde yardımcı olabilecek kişiyi seçin"})]}),(0,c.jsxs)("div",{className:"flex justify-end gap-3 pt-4 border-t border-white/10",children:[s&&(0,c.jsx)("button",{type:"button",onClick:s,disabled:n,className:"px-4 py-2.5 text-sm font-medium text-slate-300 hover:text-white transition-colors disabled:opacity-50",children:"İptal"}),(0,c.jsx)("button",{type:"submit",disabled:n||m,className:"px-5 py-2.5 text-sm font-semibold text-white bg-gradient-to-r from-red-600 to-orange-600 rounded-xl hover:from-red-500 hover:to-orange-500 hover:shadow-lg hover:shadow-red-500/25 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed",children:n?"Bildiriliyor...":"Sorunu Bildir"})]})]})};var u={low:"bg-slate-500/20 text-slate-300",medium:"bg-blue-500/20 text-blue-400",high:"bg-orange-500/20 text-orange-400",critical:"bg-red-500/20 text-red-400"},x={low:"Düşük",medium:"Orta",high:"Yüksek",critical:"Kritik"},h={pending_assignment:"bg-amber-500/20 text-amber-400",assigned:"bg-blue-500/20 text-blue-400",in_progress:"bg-purple-500/20 text-purple-400",resolved:"bg-emerald-500/20 text-emerald-400",closed:"bg-slate-500/20 text-slate-300"},p={pending_assignment:"Atama Bekliyor",assigned:"Atandı",in_progress:"Devam Ediyor",resolved:"Çözüldü",closed:"Kapatıldı"};const g=({issue:e,onClick:s,showActions:t=!1,onAssign:i})=>{return(0,c.jsx)("div",{className:a("glass-card p-5 rounded-xl transition-all duration-300","hover:scale-[1.01] hover:shadow-xl hover:shadow-red-500/5",s?"cursor-pointer":""),onClick:s,children:(0,c.jsxs)("div",{className:"space-y-4",children:[(0,c.jsxs)("div",{className:"flex items-start justify-between",children:[(0,c.jsxs)("div",{className:"flex-1",children:[(0,c.jsx)("h3",{className:"text-lg font-semibold text-white mb-1",children:e.title}),(0,c.jsx)("p",{className:"text-sm text-slate-400 line-clamp-2",children:e.description})]}),(0,c.jsxs)("div",{className:"flex flex-col items-end space-y-2 ml-4",children:[(0,c.jsx)("span",{className:a("px-2.5 py-1 text-xs font-medium rounded-full",u[e.priority]),children:x[e.priority]}),(0,c.jsx)("span",{className:a("px-2.5 py-1 text-xs font-medium rounded-full",h[e.status]),children:p[e.status]})]})]}),(0,c.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[(0,c.jsxs)("div",{children:[(0,c.jsx)("span",{className:"text-slate-500",children:"Bildiren:"}),(0,c.jsx)("span",{className:"ml-2 font-medium text-white",children:e.reported_by_profile?.full_name||"Bilinmiyor"})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("span",{className:"text-slate-500",children:"Önerilen Kişi:"}),(0,c.jsx)("span",{className:"ml-2 font-medium text-white",children:e.suggested_assignee_profile?.full_name||"Bilinmiyor"})]}),e.assigned_to_profile&&(0,c.jsxs)("div",{children:[(0,c.jsx)("span",{className:"text-slate-500",children:"Atanan:"}),(0,c.jsx)("span",{className:"ml-2 font-medium text-emerald-400",children:e.assigned_to_profile.full_name})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("span",{className:"text-slate-500",children:"Oluşturulma:"}),(0,c.jsx)("span",{className:"ml-2 text-slate-300",children:(l=e.created_at,new Date(l).toLocaleDateString("tr-TR",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}))})]})]}),t&&"pending_assignment"===e.status&&i&&(0,c.jsx)("div",{className:"pt-4 border-t border-white/10",children:(0,c.jsx)("button",{onClick:s=>{s.stopPropagation(),i(e)},className:"w-full px-4 py-2.5 bg-gradient-to-r from-blue-600 to-purple-600 text-white text-sm font-semibold rounded-lg hover:from-blue-500 hover:to-purple-500 hover:shadow-lg hover:shadow-blue-500/25 transition-all duration-200",children:"Göreve Ata"})})]})});var l},b=({issues:e,loading:s=!1,onIssueClick:t,showActions:i=!1,onAssign:r,emptyMessage:n="Henüz sorun bildirimi yok"})=>{const[d,m]=(0,o.useState)("all"),u=e.filter(e=>"all"===d||("pending"===d?"pending_assignment"===e.status:"assigned"===d?"assigned"===e.status||"in_progress"===e.status:"resolved"!==d||("resolved"===e.status||"closed"===e.status)));if(s)return(0,c.jsx)("div",{className:"flex justify-center items-center py-12",children:(0,c.jsx)(l,{size:"lg",message:"Sorunlar yükleniyor..."})});const x=e=>a("px-4 py-2.5 text-sm font-medium border-b-2 transition-colors",e?"border-blue-500 text-blue-400":"border-transparent text-slate-500 hover:text-slate-300");return(0,c.jsxs)("div",{className:"space-y-4",children:[(0,c.jsxs)("div",{className:"flex space-x-1 border-b border-white/10 overflow-x-auto scrollbar-hide",children:[(0,c.jsxs)("button",{onClick:()=>m("all"),className:x("all"===d),children:["Tümü (",e.length,")"]}),(0,c.jsxs)("button",{onClick:()=>m("pending"),className:x("pending"===d),children:["Bekleyen (",e.filter(e=>"pending_assignment"===e.status).length,")"]}),(0,c.jsxs)("button",{onClick:()=>m("assigned"),className:x("assigned"===d),children:["Atandı (",e.filter(e=>"assigned"===e.status||"in_progress"===e.status).length,")"]}),(0,c.jsxs)("button",{onClick:()=>m("resolved"),className:x("resolved"===d),children:["Çözüldü (",e.filter(e=>"resolved"===e.status||"closed"===e.status).length,")"]})]}),0===u.length?(0,c.jsxs)("div",{className:"glass-card p-10 rounded-xl text-center",children:[(0,c.jsx)("svg",{className:"mx-auto h-12 w-12 text-slate-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,c.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),(0,c.jsx)("h3",{className:"mt-3 text-base font-medium text-white",children:n})]}):(0,c.jsx)("div",{className:"grid gap-4",children:u.map(e=>(0,c.jsx)(g,{issue:e,onClick:t?()=>t(e):void 0,showActions:i,onAssign:r},e.id))})]})};var f="Düşük",j="Orta",v="Yüksek",y="Kritik";const N=({issue:e,isOpen:s,onClose:t,onAssign:a})=>{const[l,m]=(0,o.useState)(e.suggested_assignee_id),[u,x]=(0,o.useState)(e.title),[h,p]=(0,o.useState)(e.description),[g,b]=(0,o.useState)(e.priority),[N,k]=(0,o.useState)([]),[_,w]=(0,o.useState)(!1),[S,C]=(0,o.useState)(!0),[A,z]=(0,o.useState)(null);(0,o.useEffect)(()=>{s&&(B(),m(e.suggested_assignee_id),x(e.title),p(e.description),b(e.priority),z(null))},[s,e]);const B=async()=>{try{C(!0);const{data:e,error:s}=await i.from("profiles").select("id, full_name, email, department, role").order("full_name");if(s)throw s;k(e||[])}catch(e){z("Çalışanlar yüklenirken hata oluştu")}finally{C(!1)}},K=N.find(s=>s.id===e.suggested_assignee_id),D=l===e.suggested_assignee_id;return(0,c.jsx)(n,{isOpen:s,onClose:t,title:"Sorun Ataması",children:(0,c.jsxs)("div",{className:"space-y-6",children:[A&&(0,c.jsx)("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg",children:A}),(0,c.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:(0,c.jsxs)("div",{className:"flex items-start",children:[(0,c.jsx)("div",{className:"flex-shrink-0",children:(0,c.jsx)("svg",{className:"h-5 w-5 text-blue-400",fill:"currentColor",viewBox:"0 0 20 20",children:(0,c.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),(0,c.jsxs)("div",{className:"ml-3",children:[(0,c.jsx)("h3",{className:"text-sm font-medium text-blue-800",children:"Önerilen Kişi"}),(0,c.jsxs)("div",{className:"mt-2 text-sm text-blue-700",children:[(0,c.jsxs)("p",{children:[(0,c.jsx)("strong",{children:K?.full_name||"Bilinmiyor"}),K?.department&&` (${K.department})`]}),(0,c.jsxs)("p",{className:"text-xs mt-1",children:[e.reported_by_profile?.full_name," tarafından önerildi"]})]})]})]})}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{htmlFor:"edit-title",className:"block text-sm font-medium text-gray-700 mb-2",children:"Sorun Başlığı"}),(0,c.jsx)(d,{id:"edit-title",type:"text",value:u,onChange:e=>x(e.target.value),disabled:_})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{htmlFor:"edit-description",className:"block text-sm font-medium text-gray-700 mb-2",children:"Sorun Açıklaması"}),(0,c.jsx)("textarea",{id:"edit-description",value:h,onChange:e=>p(e.target.value),disabled:_,rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed"})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{htmlFor:"edit-priority",className:"block text-sm font-medium text-gray-700 mb-2",children:"Öncelik"}),(0,c.jsxs)("select",{id:"edit-priority",value:g,onChange:e=>b(e.target.value),disabled:_,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed",children:[(0,c.jsx)("option",{value:"low",children:f}),(0,c.jsx)("option",{value:"medium",children:j}),(0,c.jsx)("option",{value:"high",children:v}),(0,c.jsx)("option",{value:"critical",children:y})]})]}),(0,c.jsxs)("div",{children:[(0,c.jsxs)("label",{htmlFor:"assignee",className:"block text-sm font-medium text-gray-700 mb-2",children:["Atanacak Kişi ",(0,c.jsx)("span",{className:"text-red-500",children:"*"})]}),S?(0,c.jsx)("div",{className:"text-sm text-gray-500",children:"Çalışanlar yükleniyor..."}):(0,c.jsx)("select",{id:"assignee",value:l,onChange:e=>m(e.target.value),disabled:_,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed",children:N.map(s=>(0,c.jsxs)("option",{value:s.id,children:[s.full_name,s.id===e.suggested_assignee_id&&" (Önerilen)",s.department&&` - ${s.department}`]},s.id))}),D&&(0,c.jsx)("p",{className:"mt-1 text-sm text-green-600",children:"✓ Önerilen kişiye atanacak"})]}),(0,c.jsxs)("div",{className:"flex justify-end space-x-3 pt-4 border-t border-gray-200",children:[(0,c.jsx)(r,{type:"button",variant:"secondary",onClick:t,disabled:_,children:"İptal"}),(0,c.jsx)(r,{type:"button",variant:"primary",onClick:async()=>{if(z(null),l)if(u.trim())if(h.trim())try{w(!0);const s={assignee_id:l};u===e.title&&h===e.description&&g===e.priority||(s.edited_issue={title:u,description:h,priority:g}),await a(e.id,s),t()}catch(s){z(s instanceof Error?s.message:"Atama sırasında hata oluştu")}finally{w(!1)}else z("Açıklama boş olamaz");else z("Başlık boş olamaz");else z("Lütfen atanacak kişiyi seçin")},disabled:_||S,children:_?"Atanıyor...":"Görevi Ata"})]})]})})};export{b as n,m as r,N as t};