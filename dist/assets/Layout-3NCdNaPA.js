import{J as e,L as t,M as s,T as a,Tt as i,a as n,b as r,bt as l,d as o,gt as d,i as c,k as h,n as m,o as x,r as u,t as f,u as p,w as b,xt as w,z as v}from"./react-vendor-DnbmBACz.js";import{i as g,n as j,r as N}from"./index-CDPVztAZ.js";import{t as y}from"./NotificationBell-DpekPiHl.js";var k=i(),A=e();const M=({onMenuClick:e})=>{const{user:s,logout:a,isAdmin:i}=N(),[n,r]=(0,k.useState)([]),[l,o]=(0,k.useState)(0);(0,k.useEffect)(()=>{c();const e=g.channel("notifications-realtime").on("postgres_changes",{event:"INSERT",schema:"public",table:"notifications"},e=>{const t=e.new;t.user_id&&t.user_id!==s?.id||(r(e=>[t,...e.slice(0,19)]),o(e=>e+1))}).subscribe();return()=>{g.removeChannel(e)}},[s?.id]);const c=async()=>{try{const{data:{session:e}}=await g.auth.getSession();if(!e)return;const t=await fetch("http://localhost:3001/api/notifications?limit=10",{headers:{Authorization:`Bearer ${e.access_token}`}});if(t.ok){const e=await t.json();r(e.data?.notifications||[]),o(e.data?.unreadCount||0)}}catch(e){}};return(0,A.jsx)("header",{className:"sticky top-0 z-40 glass-dark border-b border-white/5",children:(0,A.jsxs)("div",{className:"flex items-center justify-between h-16 px-4 sm:px-6 lg:px-8",children:[(0,A.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,A.jsx)("button",{onClick:e,className:"lg:hidden p-2 rounded-xl text-slate-400 hover:text-white hover:bg-white/5 transition-all duration-200 [&>svg]:w-6 [&>svg]:h-6","aria-label":"Open menu",children:(0,A.jsx)(t,{className:"h-6 w-6"})}),(0,A.jsx)(d,{to:"/dashboard",className:"hidden lg:flex items-center",children:(0,A.jsx)("h1",{className:"text-xl font-bold gradient-text",children:"Modern Office System"})})]}),(0,A.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,A.jsx)(y,{count:l,notifications:n,onMarkRead:async e=>{try{const{data:{session:t}}=await g.auth.getSession();if(!t)return;await fetch(`http://localhost:3001/api/notifications/${e}/read`,{method:"PUT",headers:{Authorization:`Bearer ${t.access_token}`}}),r(t=>t.map(t=>t.id===e?{...t,is_read:!0}:t)),o(e=>Math.max(0,e-1))}catch(t){}},onMarkAllRead:async()=>{try{const{data:{session:e}}=await g.auth.getSession();if(!e)return;await fetch("http://localhost:3001/api/notifications/read-all",{method:"PUT",headers:{Authorization:`Bearer ${e.access_token}`}}),r(e=>e.map(e=>({...e,is_read:!0}))),o(0)}catch(e){}}}),(0,A.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,A.jsxs)("div",{className:"hidden sm:block text-right",children:[(0,A.jsx)("p",{className:"text-sm font-medium text-white",children:s?.profile?.full_name||s?.email?.split("@")[0]}),i&&(0,A.jsx)("span",{className:"inline-flex items-center px-2 py-0.5 text-xs font-semibold text-blue-400 bg-blue-500/10 rounded-full",children:"Admin"})]}),(0,A.jsx)(d,{to:"/profile",className:"w-9 h-9 rounded-xl bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white font-semibold text-sm hover:shadow-lg hover:shadow-blue-500/25 transition-all duration-200",children:(s?.profile?.full_name||s?.email||"U")[0].toUpperCase()})]}),(0,A.jsxs)("button",{onClick:async()=>{try{await a()}catch(e){}},className:"hidden sm:inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-white bg-gradient-to-r from-blue-600 to-purple-600 rounded-xl hover:from-blue-500 hover:to-purple-500 hover:shadow-lg hover:shadow-blue-500/25 transition-all duration-200 [&>svg]:w-4 [&>svg]:h-4",children:[(0,A.jsx)(v,{className:"h-4 w-4"}),"Çıkış"]})]})]})})},O=({isOpen:e,onClose:t})=>{const a=l(),{isAdmin:i}=N(),n=[{name:"Dashboard",href:"/dashboard",icon:r,adminOnly:!1},{name:"Görevler",href:"/tasks",icon:h,adminOnly:!1},{name:"Sorunlar",href:"/issues",icon:b,adminOnly:!1},{name:"Analitik",href:"/analytics",icon:s,adminOnly:!1},{name:"Kullanıcılar",href:"/users",icon:p,adminOnly:!0}].filter(e=>!e.adminOnly||i);return(0,A.jsxs)(A.Fragment,{children:[e&&(0,A.jsx)("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-40 lg:hidden",onClick:t}),(0,A.jsx)("aside",{className:j("fixed inset-y-0 left-0 z-50 w-64 transform transition-transform duration-300 ease-in-out lg:translate-x-0 lg:static lg:z-auto","bg-gradient-to-b from-slate-900 via-slate-900 to-slate-950","border-r border-white/5",e?"translate-x-0":"-translate-x-full"),children:(0,A.jsxs)("div",{className:"flex flex-col h-full",children:[(0,A.jsxs)("div",{className:"flex items-center justify-between h-16 px-6 border-b border-white/5",children:[(0,A.jsxs)(d,{to:"/dashboard",className:"flex items-center space-x-3",children:[(0,A.jsx)("div",{className:"w-8 h-8 rounded-lg gradient-primary flex items-center justify-center",children:(0,A.jsx)("span",{className:"text-white font-bold text-sm",children:"MO"})}),(0,A.jsx)("span",{className:"text-lg font-bold text-white",children:"Office"})]}),(0,A.jsx)("button",{onClick:t,className:"lg:hidden p-2 rounded-lg text-slate-400 hover:text-white hover:bg-white/5 transition-colors",children:(0,A.jsx)(x,{className:"h-5 w-5"})})]}),(0,A.jsx)("nav",{className:"flex-1 px-3 py-6 space-y-1 overflow-y-auto scrollbar-dark",children:n.map(e=>{const s=a.pathname===e.href;return(0,A.jsxs)(d,{to:e.href,onClick:t,className:j("group flex items-center px-4 py-3 text-sm font-medium rounded-xl transition-all duration-200",s?"bg-gradient-to-r from-blue-500/20 to-purple-500/20 text-white shadow-lg shadow-blue-500/10":"text-slate-400 hover:text-white hover:bg-white/5"),children:[(0,A.jsx)("div",{className:"mr-3 [&>svg]:w-5 [&>svg]:h-5",children:(0,A.jsx)(e.icon,{className:j("h-5 w-5 transition-colors",s?"text-blue-400":"text-slate-500 group-hover:text-slate-300")})}),e.name,s&&(0,A.jsx)("div",{className:"ml-auto w-1.5 h-1.5 rounded-full bg-blue-400 animate-pulse"})]},e.name)})}),(0,A.jsx)("div",{className:"p-4 border-t border-white/5",children:(0,A.jsxs)("div",{className:"glass rounded-xl p-3",children:[(0,A.jsx)("p",{className:"text-xs text-slate-500 text-center",children:"© 2024 Modern Office"}),(0,A.jsx)("p",{className:"text-xs text-slate-600 text-center mt-1",children:"v1.0.0"})]})})]})})]})},S=()=>/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),T=()=>/iPad|Android/i.test(navigator.userAgent)&&!C(),C=()=>/iPhone|Android.*Mobile|webOS|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),z=()=>"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0,P=()=>C()?"mobile":T()?"tablet":"desktop",_=()=>window.innerHeight>window.innerWidth?"portrait":"landscape",E=()=>window.innerWidth<768,B=()=>window.innerWidth>=768&&window.innerWidth<1024,L=()=>window.innerWidth>=1024,W=(e="light")=>{((e=200)=>{"vibrate"in navigator&&navigator.vibrate(e)})({light:10,medium:20,heavy:50}[e])},$=()=>{const e=w(),t=l(),{user:i}=N(),d=[{path:"/dashboard",label:"Ana Sayfa",icon:r,iconActive:m},{path:"/tasks",label:"Görevler",icon:h,iconActive:c},{path:"/issues",label:"Sorunlar",icon:a,iconActive:u},{path:"/analytics",label:"Analiz",icon:s,iconActive:n},{path:"/profile",label:"Profil",icon:o,iconActive:f}];return(0,A.jsx)("nav",{className:"fixed bottom-0 left-0 right-0 glass-dark border-t border-white/5 safe-area-inset-bottom z-40 md:hidden",children:(0,A.jsx)("div",{className:"flex items-center justify-around h-16",children:d.filter(e=>!e.adminOnly||"admin"===i?.profile?.role).map(s=>{const a=t.pathname===s.path,i=a?s.iconActive:s.icon;return(0,A.jsxs)("button",{onClick:()=>{return t=s.path,W("light"),void e(t);var t},className:"flex flex-col items-center justify-center flex-1 h-full transition-all duration-200 touch-manipulation "+(a?"text-blue-400":"text-slate-500 hover:text-slate-300"),children:[(0,A.jsxs)("div",{className:`relative ${a?"scale-110":""} transition-transform`,children:[(0,A.jsx)("div",{className:"[&>svg]:w-6 [&>svg]:h-6",children:(0,A.jsx)(i,{className:"h-6 w-6 mb-1"})}),a&&(0,A.jsx)("div",{className:"absolute -bottom-1 left-1/2 -translate-x-1/2 w-1 h-1 rounded-full bg-blue-400"})]}),(0,A.jsx)("span",{className:"text-xs font-medium "+(a?"text-blue-400":""),children:s.label})]},s.path)})})})},U=({children:e})=>{const[t,s]=(0,k.useState)(!1),{viewport:a}=(()=>{const[e,t]=(0,k.useState)({isMobile:S(),isTablet:T(),isPhone:C(),isTouch:z(),deviceType:P(),orientation:_(),viewport:{isSmall:E(),isMedium:B(),isLarge:L(),width:window.innerWidth,height:window.innerHeight}});return(0,k.useEffect)(()=>{const e=()=>{t({isMobile:S(),isTablet:T(),isPhone:C(),isTouch:z(),deviceType:P(),orientation:_(),viewport:{isSmall:E(),isMedium:B(),isLarge:L(),width:window.innerWidth,height:window.innerHeight}})},s=()=>{setTimeout(e,100)};return window.addEventListener("resize",e),window.addEventListener("orientationchange",s),()=>{window.removeEventListener("resize",e),window.removeEventListener("orientationchange",s)}},[]),e})();return(0,A.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950",children:[(0,A.jsx)(M,{onMenuClick:()=>s(!t)}),(0,A.jsxs)("div",{className:"flex",children:[(0,A.jsx)(O,{isOpen:t,onClose:()=>s(!1)}),(0,A.jsx)("main",{className:"flex-1 lg:ml-64",children:(0,A.jsx)("div",{className:"max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8 "+(a.isSmall?"pb-24":""),children:e})})]}),a.isSmall&&(0,A.jsx)($,{})]})};export{W as n,U as t};