import{n as e}from"./rolldown-runtime-A1xW-pDA.js";import{J as t,St as s,Tt as a,V as l,f as i,xt as r}from"./react-vendor-DnbmBACz.js";import{i as n,n as d,r as o,t as c}from"./index-CDPVztAZ.js";import{t as m}from"./Layout-3NCdNaPA.js";import{t as x}from"./Modal-Dnx87MuO.js";var u=e(a(),1),h=t(),p={not_started:"Başlamadı",in_progress:"Devam Ediyor",completed:"Tamamlandı",blocked:"Engellendi"},b={not_started:"bg-slate-500/20 text-slate-300",in_progress:"bg-blue-500/20 text-blue-400",completed:"bg-emerald-500/20 text-emerald-400",blocked:"bg-red-500/20 text-red-400"},j={low:"Düşük",medium:"Orta",high:"Yüksek",critical:"Kritik"},g={low:"bg-slate-500/20 text-slate-300",medium:"bg-blue-500/20 text-blue-400",high:"bg-orange-500/20 text-orange-400",critical:"bg-red-500/20 text-red-400"},f={routine:"Rutin",project:"Proje",one_time:"Tek Seferlik",issue_resolution:"Sorun Çözümü"};const v=()=>{const{id:e}=s(),t=r(),{isAdmin:a}=o(),[v,N]=(0,u.useState)(null),[w,y]=(0,u.useState)(!0),[k,S]=(0,u.useState)(null),[_,C]=(0,u.useState)(!1),[G,E]=(0,u.useState)(!1),[D,z]=(0,u.useState)(!1),[T,O]=(0,u.useState)(!1),[B,$]=(0,u.useState)(!1),[A,L]=(0,u.useState)(!1),[R,Y]=(0,u.useState)("not_started"),[J,K]=(0,u.useState)(0),[P,F]=(0,u.useState)(0);(0,u.useEffect)(()=>{e&&H()},[e]);const H=async()=>{try{y(!0),S(null);const{data:{session:t}}=await n.auth.getSession();if(!t)return void S("Oturum bulunamadı");const s=await fetch(`http://localhost:3001/api/tasks/${e}`,{headers:{Authorization:`Bearer ${t.access_token}`,"Content-Type":"application/json"}});if(!s.ok)throw new Error("Görev yüklenemedi");const a=await s.json();N(a.data),Y(a.data.status),K(a.data.progress_percentage),F(a.data.actual_hours||0)}catch(t){S(t instanceof Error?t.message:"Bir hata oluştu")}finally{y(!1)}},I=async t=>{try{C(!0);const{data:{session:s}}=await n.auth.getSession();if(!s)throw new Error("Oturum bulunamadı");const a=await fetch(`http://localhost:3001/api/tasks/${e}`,{method:"PUT",headers:{Authorization:`Bearer ${s.access_token}`,"Content-Type":"application/json"},body:JSON.stringify(t)});if(!a.ok)throw new Error("Görev güncellenemedi");return N((await a.json()).data),!0}catch(s){return alert(s instanceof Error?s.message:"Güncelleme başarısız"),!1}finally{C(!1)}};if(w)return(0,h.jsx)(m,{children:(0,h.jsx)("div",{className:"flex justify-center items-center min-h-[400px]",children:(0,h.jsx)(c,{size:"lg",message:"Görev yükleniyor..."})})});if(k||!v)return(0,h.jsx)(m,{children:(0,h.jsx)("div",{className:"max-w-4xl mx-auto",children:(0,h.jsxs)("div",{className:"glass-card p-6 rounded-xl border-red-500/30",children:[(0,h.jsx)("p",{className:"font-medium text-red-400",children:"Hata"}),(0,h.jsx)("p",{className:"text-sm text-slate-400 mt-1",children:k||"Görev bulunamadı"}),(0,h.jsx)("button",{onClick:()=>t("/tasks"),className:"mt-4 text-sm text-blue-400 hover:text-blue-300 font-medium transition-colors",children:"← Görevlere Dön"})]})})});const M=v.due_date&&new Date(v.due_date)<new Date&&"completed"!==v.status;return(0,h.jsxs)(m,{children:[(0,h.jsxs)("div",{className:"max-w-4xl mx-auto space-y-6",children:[(0,h.jsxs)("button",{onClick:()=>t("/tasks"),className:"inline-flex items-center gap-2 text-sm text-slate-400 hover:text-white transition-colors [&>svg]:w-4 [&>svg]:h-4",children:[(0,h.jsx)(l,{className:"h-4 w-4"}),"Görevlere Dön"]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("h1",{className:"text-2xl sm:text-3xl font-bold text-white",children:v.title}),M&&(0,h.jsx)("p",{className:"mt-2 text-sm text-red-400 font-medium",children:"⚠️ Bu görev gecikmiş"})]}),(0,h.jsxs)("div",{className:"glass-card p-6 rounded-xl space-y-6",children:[(0,h.jsxs)("div",{className:"flex flex-wrap gap-4",children:[(0,h.jsxs)("div",{children:[(0,h.jsx)("span",{className:"text-sm text-slate-400",children:"Durum:"}),(0,h.jsx)("div",{className:"mt-1",children:(0,h.jsx)("span",{className:d("px-3 py-1 text-sm font-medium rounded-full",b[v.status]),children:p[v.status]})})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("span",{className:"text-sm text-slate-400",children:"Öncelik:"}),(0,h.jsx)("div",{className:"mt-1",children:(0,h.jsx)("span",{className:d("px-3 py-1 text-sm font-medium rounded-full",g[v.priority]),children:j[v.priority]})})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("span",{className:"text-sm text-slate-400",children:"Kategori:"}),(0,h.jsx)("div",{className:"mt-1",children:(0,h.jsx)("span",{className:"px-3 py-1 text-sm font-medium rounded-full bg-purple-500/20 text-purple-400",children:f[v.category]})})]})]}),v.description&&(0,h.jsxs)("div",{children:[(0,h.jsx)("h3",{className:"text-sm font-medium text-slate-300 mb-2",children:"Açıklama"}),(0,h.jsx)("p",{className:"text-slate-400 whitespace-pre-wrap",children:v.description})]}),(0,h.jsxs)("div",{children:[(0,h.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,h.jsx)("h3",{className:"text-sm font-medium text-slate-300",children:"İlerleme"}),(0,h.jsx)("button",{onClick:()=>z(!0),className:"text-sm text-blue-400 hover:text-blue-300 font-medium transition-colors",children:"Güncelle"})]}),(0,h.jsxs)("div",{className:"flex items-center gap-4",children:[(0,h.jsx)("div",{className:"flex-1",children:(0,h.jsx)("div",{className:"w-full bg-slate-700 rounded-full h-3 overflow-hidden",children:(0,h.jsx)("div",{className:"bg-gradient-to-r from-blue-500 to-emerald-500 h-3 rounded-full transition-all duration-500",style:{width:`${v.progress_percentage}%`}})})}),(0,h.jsxs)("span",{className:"text-sm font-semibold text-white",children:[v.progress_percentage,"%"]})]})]}),(0,h.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,h.jsxs)("div",{className:"p-4 bg-slate-800/50 rounded-lg",children:[(0,h.jsx)("h3",{className:"text-sm font-medium text-slate-400 mb-1",children:"Tahmini Süre"}),(0,h.jsxs)("p",{className:"text-2xl font-semibold text-white",children:[v.estimated_hours||0," ",(0,h.jsx)("span",{className:"text-sm text-slate-400",children:"saat"})]})]}),(0,h.jsxs)("div",{className:"p-4 bg-slate-800/50 rounded-lg",children:[(0,h.jsxs)("div",{className:"flex justify-between items-start mb-1",children:[(0,h.jsx)("h3",{className:"text-sm font-medium text-slate-400",children:"Gerçekleşen Süre"}),(0,h.jsx)("button",{onClick:()=>O(!0),className:"text-xs text-blue-400 hover:text-blue-300 font-medium transition-colors",children:"Güncelle"})]}),(0,h.jsxs)("p",{className:"text-2xl font-semibold text-white",children:[v.actual_hours||0," ",(0,h.jsx)("span",{className:"text-sm text-slate-400",children:"saat"})]})]})]}),(0,h.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[v.due_date&&(0,h.jsxs)("div",{children:[(0,h.jsx)("span",{className:"text-slate-400",children:"Bitiş Tarihi:"}),(0,h.jsx)("span",{className:d("ml-2 font-medium",M?"text-red-400":"text-white"),children:new Date(v.due_date).toLocaleDateString("tr-TR")})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("span",{className:"text-slate-400",children:"Oluşturulma:"}),(0,h.jsx)("span",{className:"ml-2 font-medium text-white",children:new Date(v.created_at).toLocaleDateString("tr-TR")})]})]}),v.tags&&v.tags.length>0&&(0,h.jsxs)("div",{children:[(0,h.jsx)("h3",{className:"text-sm font-medium text-slate-300 mb-2",children:"Etiketler"}),(0,h.jsx)("div",{className:"flex flex-wrap gap-2",children:v.tags.map((e,t)=>(0,h.jsx)("span",{className:"px-3 py-1 bg-slate-700 text-slate-300 rounded-full text-sm",children:e},t))})]}),(0,h.jsxs)("div",{className:"flex gap-3 pt-4 border-t border-white/10",children:[(0,h.jsx)("button",{onClick:()=>E(!0),disabled:_,className:"px-5 py-2.5 text-sm font-semibold text-white bg-gradient-to-r from-blue-600 to-purple-600 rounded-xl hover:from-blue-500 hover:to-purple-500 hover:shadow-lg hover:shadow-blue-500/25 transition-all duration-200 disabled:opacity-50",children:"Durumu Güncelle"}),(0,h.jsx)("button",{onClick:()=>t(`/tasks/${e}/edit`),disabled:_,className:"px-5 py-2.5 text-sm font-medium text-slate-300 bg-slate-700 hover:bg-slate-600 rounded-xl transition-colors disabled:opacity-50",children:"Düzenle"}),a&&(0,h.jsxs)("button",{onClick:()=>$(!0),disabled:_||A,className:"px-5 py-2.5 text-sm font-medium text-red-400 bg-red-500/10 hover:bg-red-500/20 border border-red-500/30 rounded-xl transition-colors disabled:opacity-50 ml-auto flex items-center gap-2",children:[(0,h.jsx)(i,{className:"w-4 h-4"}),"Sil"]})]})]})]}),(0,h.jsx)(x,{isOpen:G,onClose:()=>E(!1),title:"Durum Güncelle",children:(0,h.jsxs)("div",{className:"space-y-4",children:[(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Yeni Durum"}),(0,h.jsxs)("select",{value:R,onChange:e=>Y(e.target.value),className:"w-full bg-slate-800 border border-white/10 rounded-lg px-3 py-2 text-white focus:border-blue-500 focus:ring-1 focus:ring-blue-500 outline-none",children:[(0,h.jsx)("option",{value:"not_started",children:"Başlamadı"}),(0,h.jsx)("option",{value:"in_progress",children:"Devam Ediyor"}),(0,h.jsx)("option",{value:"completed",children:"Tamamlandı"}),(0,h.jsx)("option",{value:"blocked",children:"Engellendi"})]})]}),(0,h.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,h.jsx)("button",{onClick:()=>E(!1),disabled:_,className:"px-4 py-2 text-sm font-medium text-slate-300 hover:text-white transition-colors",children:"İptal"}),(0,h.jsx)("button",{onClick:async()=>{await I({status:R})&&E(!1)},disabled:_,className:"px-4 py-2 text-sm font-semibold text-white bg-gradient-to-r from-blue-600 to-purple-600 rounded-lg hover:from-blue-500 hover:to-purple-500 transition-all disabled:opacity-50",children:_?"Güncelleniyor...":"Güncelle"})]})]})}),(0,h.jsx)(x,{isOpen:D,onClose:()=>z(!1),title:"İlerleme Güncelle",children:(0,h.jsxs)("div",{className:"space-y-4",children:[(0,h.jsxs)("div",{children:[(0,h.jsxs)("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:["İlerleme Yüzdesi: ",(0,h.jsxs)("span",{className:"text-white font-semibold",children:[J,"%"]})]}),(0,h.jsx)("input",{type:"range",min:"0",max:"100",value:J,onChange:e=>K(parseInt(e.target.value)),className:"w-full accent-blue-500"})]}),(0,h.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,h.jsx)("button",{onClick:()=>z(!1),disabled:_,className:"px-4 py-2 text-sm font-medium text-slate-300 hover:text-white transition-colors",children:"İptal"}),(0,h.jsx)("button",{onClick:async()=>{await I({progress_percentage:J})&&z(!1)},disabled:_,className:"px-4 py-2 text-sm font-semibold text-white bg-gradient-to-r from-blue-600 to-purple-600 rounded-lg hover:from-blue-500 hover:to-purple-500 transition-all disabled:opacity-50",children:_?"Güncelleniyor...":"Güncelle"})]})]})}),(0,h.jsx)(x,{isOpen:T,onClose:()=>O(!1),title:"Gerçekleşen Süre Güncelle",children:(0,h.jsxs)("div",{className:"space-y-4",children:[(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Gerçekleşen Süre (saat)"}),(0,h.jsx)("input",{type:"number",min:"0",step:"0.5",value:P,onChange:e=>F(parseFloat(e.target.value)||0),className:"w-full bg-slate-800 border border-white/10 rounded-lg px-3 py-2 text-white focus:border-blue-500 focus:ring-1 focus:ring-blue-500 outline-none"})]}),(0,h.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,h.jsx)("button",{onClick:()=>O(!1),disabled:_,className:"px-4 py-2 text-sm font-medium text-slate-300 hover:text-white transition-colors",children:"İptal"}),(0,h.jsx)("button",{onClick:async()=>{await I({actual_hours:P})&&O(!1)},disabled:_,className:"px-4 py-2 text-sm font-semibold text-white bg-gradient-to-r from-blue-600 to-purple-600 rounded-lg hover:from-blue-500 hover:to-purple-500 transition-all disabled:opacity-50",children:_?"Güncelleniyor...":"Güncelle"})]})]})}),(0,h.jsx)(x,{isOpen:B,onClose:()=>$(!1),title:"Görevi Sil",children:(0,h.jsxs)("div",{className:"space-y-4",children:[(0,h.jsxs)("p",{className:"text-slate-300",children:[(0,h.jsx)("strong",{className:"text-white",children:v.title})," görevini silmek istediğinize emin misiniz?"]}),(0,h.jsx)("p",{className:"text-sm text-red-400",children:"Bu işlem geri alınamaz."}),(0,h.jsxs)("div",{className:"flex justify-end gap-3 pt-2",children:[(0,h.jsx)("button",{onClick:()=>$(!1),disabled:A,className:"px-4 py-2 text-sm font-medium text-slate-300 hover:text-white transition-colors",children:"İptal"}),(0,h.jsx)("button",{onClick:async()=>{try{L(!0);const{data:{session:s}}=await n.auth.getSession();if(!s)throw new Error("Oturum bulunamadı");if(!(await fetch(`http://localhost:3001/api/tasks/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${s.access_token}`}})).ok)throw new Error("Görev silinemedi");t("/tasks")}catch(s){alert(s instanceof Error?s.message:"Silme başarısız")}finally{L(!1),$(!1)}},disabled:A,className:"px-4 py-2 text-sm font-semibold text-white bg-red-600 hover:bg-red-500 rounded-lg transition-all disabled:opacity-50",children:A?"Siliniyor...":"Evet, Sil"})]})]})})]})};export{v as t};