import{F as e,I as t,R as a,S as s,V as r,d as n,o as l,v as i,vt as o,z as d}from"./react-vendor-BrW68ebb.js";import"./supabase-vendor-CLitCmdP.js";import{i as c,t as m}from"./index-BngHtetc.js";import"./NotificationBell-D0CR4O40.js";import{t as x}from"./Layout-DFNvthLu.js";import{n as u,t as p}from"./Modal-VQNNPo-d.js";import{t as g}from"./Card-CQwe59rg.js";var h=o(),y=r();const b=({onApplyFilters:e,onClearFilters:t,savedPresets:a=[],onSavePreset:s,onLoadPreset:r})=>{const[n,o]=(0,h.useState)(!1),[d,c]=(0,h.useState)({}),[m,x]=(0,h.useState)(""),[p,b]=(0,h.useState)(!1),f=(e,t)=>{c(a=>({...a,dateRange:{...a.dateRange,start:"start"===e?t:a.dateRange?.start||"",end:"end"===e?t:a.dateRange?.end||""}}))},j=(e,t)=>{c(a=>{const s=a[e]||[],r=s.includes(t)?s.filter(e=>e!==t):[...s,t];return{...a,[e]:r.length>0?r:void 0}})},v=Object.keys(d).filter(e=>{const t=d[e];return Array.isArray(t)?t.length>0:"object"==typeof t?Object.keys(t).length>0:!!t}).length;return(0,y.jsx)(g,{padding:"md",children:(0,y.jsxs)("div",{className:"space-y-4",children:[(0,y.jsxs)("div",{className:"flex items-center justify-between",children:[(0,y.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,y.jsx)(i,{className:"h-5 w-5 text-gray-600"}),(0,y.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Gelişmiş Filtreler"}),v>0&&(0,y.jsxs)("span",{className:"px-2 py-1 text-xs font-semibold text-blue-800 bg-blue-100 rounded-full",children:[v," aktif"]})]}),(0,y.jsx)("button",{onClick:()=>o(!n),className:"text-sm font-medium text-blue-600 hover:text-blue-700",children:n?"Gizle":"Göster"})]}),a.length>0&&(0,y.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,y.jsx)("span",{className:"text-sm text-gray-600",children:"Kayıtlı Filtreler:"}),a.map(e=>(0,y.jsx)("button",{onClick:()=>(e=>{c(e.filters),r&&r(e)})(e),className:"px-3 py-1 text-sm font-medium text-gray-700 bg-gray-100 rounded-full hover:bg-gray-200 transition-colors",children:e.name},e.id))]}),n&&(0,y.jsxs)("div",{className:"space-y-4 pt-4 border-t border-gray-200",children:[(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tarih Aralığı"}),(0,y.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:"block text-xs text-gray-600 mb-1",children:"Başlangıç"}),(0,y.jsx)("input",{type:"date",value:d.dateRange?.start||"",onChange:e=>f("start",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"})]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:"block text-xs text-gray-600 mb-1",children:"Bitiş"}),(0,y.jsx)("input",{type:"date",value:d.dateRange?.end||"",onChange:e=>f("end",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"})]})]})]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Durum"}),(0,y.jsx)("div",{className:"grid grid-cols-2 gap-2",children:["not_started","in_progress","completed","blocked"].map(e=>(0,y.jsxs)("label",{className:"flex items-center space-x-2",children:[(0,y.jsx)("input",{type:"checkbox",checked:(d.status||[]).includes(e),onChange:()=>j("status",e),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),(0,y.jsxs)("span",{className:"text-sm text-gray-700",children:["not_started"===e&&"Başlamadı","in_progress"===e&&"Devam Ediyor","completed"===e&&"Tamamlandı","blocked"===e&&"Engellendi"]})]},e))})]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Öncelik"}),(0,y.jsx)("div",{className:"grid grid-cols-2 gap-2",children:["low","medium","high","critical"].map(e=>(0,y.jsxs)("label",{className:"flex items-center space-x-2",children:[(0,y.jsx)("input",{type:"checkbox",checked:(d.priority||[]).includes(e),onChange:()=>j("priority",e),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),(0,y.jsxs)("span",{className:"text-sm text-gray-700",children:["low"===e&&"Düşük","medium"===e&&"Orta","high"===e&&"Yüksek","critical"===e&&"Kritik"]})]},e))})]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Kategori"}),(0,y.jsx)("div",{className:"grid grid-cols-2 gap-2",children:["routine","project","one_time","issue_resolution"].map(e=>(0,y.jsxs)("label",{className:"flex items-center space-x-2",children:[(0,y.jsx)("input",{type:"checkbox",checked:(d.category||[]).includes(e),onChange:()=>j("category",e),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),(0,y.jsxs)("span",{className:"text-sm text-gray-700",children:["routine"===e&&"Rutin","project"===e&&"Proje","one_time"===e&&"Tek Seferlik","issue_resolution"===e&&"Sorun Çözümü"]})]},e))})]}),(0,y.jsxs)("div",{className:"flex items-center justify-between pt-4 border-t border-gray-200",children:[(0,y.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,y.jsx)(u,{variant:"primary",onClick:()=>{e(d),o(!1)},children:"Filtreleri Uygula"}),(0,y.jsxs)(u,{variant:"secondary",onClick:()=>{c({}),t()},children:[(0,y.jsx)(l,{className:"h-4 w-4 mr-1"}),"Temizle"]})]}),s&&(0,y.jsx)("button",{onClick:()=>b(!p),className:"text-sm font-medium text-blue-600 hover:text-blue-700",children:"Filtreyi Kaydet"})]}),p&&s&&(0,y.jsxs)("div",{className:"flex items-center space-x-2 pt-2",children:[(0,y.jsx)("input",{type:"text",value:m,onChange:e=>x(e.target.value),placeholder:"Filtre adı...",className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"}),(0,y.jsx)(u,{variant:"primary",onClick:()=>{m.trim()&&s&&(s(m.trim(),d),x(""),b(!1))},disabled:!m.trim(),children:"Kaydet"})]})]})]})})},f=(e,t="tasks-export.csv")=>{const a=e.map(e=>[e.id,e.title,e.description||"",v(e.category),k(e.priority),N(e.status),e.progress_percentage,e.assigned_to_profile?.full_name||"",e.created_by_profile?.full_name||"",e.due_date?new Date(e.due_date).toLocaleDateString("tr-TR"):"",new Date(e.created_at).toLocaleDateString("tr-TR"),new Date(e.updated_at).toLocaleDateString("tr-TR")]),s=[["ID","Başlık","Açıklama","Kategori","Öncelik","Durum","İlerleme (%)","Atanan Kişi","Oluşturan","Bitiş Tarihi","Oluşturulma Tarihi","Güncellenme Tarihi"].join(","),...a.map(e=>e.map(e=>`"${String(e).replace(/"/g,'""')}"`).join(","))].join("\n"),r=new Blob(["\ufeff"+s],{type:"text/csv;charset=utf-8;"}),n=document.createElement("a"),l=URL.createObjectURL(r);n.setAttribute("href",l),n.setAttribute("download",t),n.style.visibility="hidden",document.body.appendChild(n),n.click(),document.body.removeChild(n)},j=(e,t="tasks-report.pdf")=>{const a=`\n    <!DOCTYPE html>\n    <html>\n    <head>\n      <meta charset="UTF-8">\n      <title>Görev Raporu</title>\n      <style>\n        body {\n          font-family: Arial, sans-serif;\n          margin: 20px;\n          color: #333;\n        }\n        h1 {\n          color: #2563eb;\n          border-bottom: 2px solid #2563eb;\n          padding-bottom: 10px;\n        }\n        .summary {\n          background: #f3f4f6;\n          padding: 15px;\n          border-radius: 8px;\n          margin: 20px 0;\n        }\n        .summary-item {\n          display: inline-block;\n          margin-right: 30px;\n        }\n        table {\n          width: 100%;\n          border-collapse: collapse;\n          margin-top: 20px;\n        }\n        th {\n          background: #2563eb;\n          color: white;\n          padding: 12px;\n          text-align: left;\n          font-weight: 600;\n        }\n        td {\n          padding: 10px;\n          border-bottom: 1px solid #e5e7eb;\n        }\n        tr:hover {\n          background: #f9fafb;\n        }\n        .priority-critical { color: #dc2626; font-weight: bold; }\n        .priority-high { color: #ea580c; font-weight: bold; }\n        .priority-medium { color: #ca8a04; }\n        .priority-low { color: #16a34a; }\n        .status-completed { color: #16a34a; }\n        .status-in-progress { color: #2563eb; }\n        .status-blocked { color: #dc2626; }\n        .footer {\n          margin-top: 30px;\n          text-align: center;\n          color: #6b7280;\n          font-size: 12px;\n        }\n      </style>\n    </head>\n    <body>\n      <h1>Görev Raporu</h1>\n      <p>Oluşturulma Tarihi: ${(new Date).toLocaleDateString("tr-TR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}</p>\n      \n      <div class="summary">\n        <div class="summary-item">\n          <strong>Toplam Görev:</strong> ${e.length}\n        </div>\n        <div class="summary-item">\n          <strong>Tamamlanan:</strong> ${e.filter(e=>"completed"===e.status).length}\n        </div>\n        <div class="summary-item">\n          <strong>Devam Eden:</strong> ${e.filter(e=>"in_progress"===e.status).length}\n        </div>\n        <div class="summary-item">\n          <strong>Tamamlanma Oranı:</strong> ${Math.round(e.filter(e=>"completed"===e.status).length/e.length*100)}%\n        </div>\n      </div>\n\n      <table>\n        <thead>\n          <tr>\n            <th>Başlık</th>\n            <th>Kategori</th>\n            <th>Öncelik</th>\n            <th>Durum</th>\n            <th>İlerleme</th>\n            <th>Atanan</th>\n            <th>Bitiş Tarihi</th>\n          </tr>\n        </thead>\n        <tbody>\n          ${e.map(e=>`\n            <tr>\n              <td><strong>${w(e.title)}</strong></td>\n              <td>${v(e.category)}</td>\n              <td class="priority-${e.priority}">${k(e.priority)}</td>\n              <td class="status-${e.status.replace("_","-")}">${N(e.status)}</td>\n              <td>${e.progress_percentage}%</td>\n              <td>${w(e.assigned_to_profile?.full_name||"-")}</td>\n              <td>${e.due_date?new Date(e.due_date).toLocaleDateString("tr-TR"):"-"}</td>\n            </tr>\n          `).join("")}\n        </tbody>\n      </table>\n\n      <div class="footer">\n        <p>Modern Office System - Görev Yönetim Raporu</p>\n      </div>\n    </body>\n    </html>\n  `,s=window.open("","_blank");s&&(s.document.write(a),s.document.close(),s.onload=()=>{s.print()})};function v(e){return{routine:"Rutin",project:"Proje",one_time:"Tek Seferlik",issue_resolution:"Sorun Çözümü"}[e]||e}function k(e){return{low:"Düşük",medium:"Orta",high:"Yüksek",critical:"Kritik"}[e]||e}function N(e){return{not_started:"Başlamadı",in_progress:"Devam Ediyor",completed:"Tamamlandı",blocked:"Engellendi"}[e]||e}function w(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}const _=({tasks:r,disabled:l=!1})=>{const[i,o]=(0,h.useState)(!1),[d,c]=(0,h.useState)(["title","category","priority","status","assigned_to_profile","due_date"]),m=()=>{f(r,`gorevler-${(new Date).toISOString().split("T")[0]}.csv`)},x=()=>{j(r,`gorev-raporu-${(new Date).toISOString().split("T")[0]}.pdf`)},g=e=>{const t="csv"===e?`gorevler-ozel-${(new Date).toISOString().split("T")[0]}.csv`:`gorev-raporu-ozel-${(new Date).toISOString().split("T")[0]}.pdf`;"csv"===e?f(r,t):j(r,t),o(!1)};return(0,y.jsxs)(y.Fragment,{children:[(0,y.jsxs)(t,{as:"div",className:"relative inline-block text-left",children:[(0,y.jsxs)(t.Button,{as:u,variant:"secondary",disabled:l||0===r.length,children:[(0,y.jsx)(e,{className:"h-5 w-5 mr-2"}),"Dışa Aktar"]}),(0,y.jsx)(a,{as:h.Fragment,enter:"transition ease-out duration-100",enterFrom:"transform opacity-0 scale-95",enterTo:"transform opacity-100 scale-100",leave:"transition ease-in duration-75",leaveFrom:"transform opacity-100 scale-100",leaveTo:"transform opacity-0 scale-95",children:(0,y.jsx)(t.Items,{className:"absolute right-0 z-10 mt-2 w-56 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none",children:(0,y.jsxs)("div",{className:"py-1",children:[(0,y.jsx)(t.Item,{children:({active:e})=>(0,y.jsxs)("button",{onClick:m,className:(e?"bg-gray-100 text-gray-900":"text-gray-700")+" group flex items-center w-full px-4 py-2 text-sm",children:[(0,y.jsx)(n,{className:"mr-3 h-5 w-5 text-gray-400"}),"CSV olarak indir"]})}),(0,y.jsx)(t.Item,{children:({active:e})=>(0,y.jsxs)("button",{onClick:x,className:(e?"bg-gray-100 text-gray-900":"text-gray-700")+" group flex items-center w-full px-4 py-2 text-sm",children:[(0,y.jsx)(s,{className:"mr-3 h-5 w-5 text-gray-400"}),"PDF raporu oluştur"]})}),(0,y.jsx)("div",{className:"border-t border-gray-100 my-1"}),(0,y.jsx)(t.Item,{children:({active:t})=>(0,y.jsxs)("button",{onClick:()=>o(!0),className:(t?"bg-gray-100 text-gray-900":"text-gray-700")+" group flex items-center w-full px-4 py-2 text-sm",children:[(0,y.jsx)(e,{className:"mr-3 h-5 w-5 text-gray-400"}),"Özel rapor oluştur"]})})]})})})]}),(0,y.jsx)(p,{isOpen:i,onClose:()=>o(!1),title:"Özel Rapor Oluştur",children:(0,y.jsxs)("div",{className:"space-y-4",children:[(0,y.jsx)("p",{className:"text-sm text-gray-600",children:"Rapora dahil etmek istediğiniz alanları seçin:"}),(0,y.jsx)("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:[{key:"title",label:"Başlık"},{key:"description",label:"Açıklama"},{key:"category",label:"Kategori"},{key:"priority",label:"Öncelik"},{key:"status",label:"Durum"},{key:"progress_percentage",label:"İlerleme"},{key:"assigned_to_profile",label:"Atanan Kişi"},{key:"created_by_profile",label:"Oluşturan"},{key:"due_date",label:"Bitiş Tarihi"},{key:"created_at",label:"Oluşturulma Tarihi"},{key:"updated_at",label:"Güncellenme Tarihi"}].map(e=>(0,y.jsxs)("label",{className:"flex items-center space-x-2",children:[(0,y.jsx)("input",{type:"checkbox",checked:d.includes(e.key),onChange:()=>{return t=e.key,void c(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t]);var t},className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),(0,y.jsx)("span",{className:"text-sm text-gray-700",children:e.label})]},e.key))}),(0,y.jsxs)("div",{className:"pt-4 border-t border-gray-200",children:[(0,y.jsx)("p",{className:"text-sm text-gray-600 mb-3",children:"Format seçin:"}),(0,y.jsxs)("div",{className:"flex space-x-3",children:[(0,y.jsxs)(u,{variant:"secondary",onClick:()=>g("csv"),disabled:0===d.length,children:[(0,y.jsx)(n,{className:"h-5 w-5 mr-2"}),"CSV"]}),(0,y.jsxs)(u,{variant:"secondary",onClick:()=>g("pdf"),disabled:0===d.length,children:[(0,y.jsx)(s,{className:"h-5 w-5 mr-2"}),"PDF"]})]})]}),(0,y.jsx)("div",{className:"flex justify-end pt-4 border-t border-gray-200",children:(0,y.jsx)(u,{variant:"secondary",onClick:()=>o(!1),children:"İptal"})})]})})]})};var S={critical:"bg-red-500/20 text-red-400",high:"bg-orange-500/20 text-orange-400",medium:"bg-amber-500/20 text-amber-400",low:"bg-slate-500/20 text-slate-400"},D={completed:"bg-emerald-500/20 text-emerald-400",in_progress:"bg-blue-500/20 text-blue-400",blocked:"bg-red-500/20 text-red-400",not_started:"bg-slate-500/20 text-slate-400"},T={critical:"Kritik",high:"Yüksek",medium:"Orta",low:"Düşük"},C={completed:"Tamamlandı",in_progress:"Devam Ediyor",blocked:"Engellendi",not_started:"Başlamadı"};const R=()=>{const[e,t]=(0,h.useState)({}),[a,s]=(0,h.useState)(()=>{const e=localStorage.getItem("filterPresets");return e?JSON.parse(e):[]}),{data:r,isLoading:n,error:l,refetch:i}=d({queryKey:["filtered-tasks",e],queryFn:()=>(async e=>{const{data:{session:t}}=await c.auth.getSession();if(!t)throw new Error("No active session");const a=new URLSearchParams;e.status&&e.status.length>0&&e.status.forEach(e=>a.append("status",e)),e.priority&&e.priority.length>0&&e.priority.forEach(e=>a.append("priority",e)),e.category&&e.category.length>0&&e.category.forEach(e=>a.append("category",e)),e.assignedTo&&a.append("assigned_to",e.assignedTo),e.createdBy&&a.append("created_by",e.createdBy);const s=await fetch(`http://localhost:3001/api/tasks?${a.toString()}`,{headers:{Authorization:`Bearer ${t.access_token}`}});if(!s.ok)throw new Error("Failed to fetch filtered tasks");let r=(await s.json()).data||[];return(e.dateRange?.start||e.dateRange?.end)&&(r=r.filter(t=>{const a=new Date(t.created_at);if(e.dateRange?.start&&a<new Date(e.dateRange.start))return!1;if(e.dateRange?.end){const t=new Date(e.dateRange.end);if(t.setHours(23,59,59,999),a>t)return!1}return!0})),r})(e),enabled:Object.keys(e).length>0}),o=Object.keys(e).filter(t=>{const a=e[t];return Array.isArray(a)?a.length>0:"object"==typeof a?Object.keys(a).length>0:!!a}).length;return(0,y.jsx)(x,{children:(0,y.jsxs)("div",{className:"space-y-6",children:[(0,y.jsxs)("div",{children:[(0,y.jsx)("h1",{className:"text-2xl font-bold text-white",children:"Analitik ve Raporlama"}),(0,y.jsx)("p",{className:"mt-1 text-sm text-slate-400",children:"Gelişmiş filtreler ile görevleri analiz edin ve raporlayın"})]}),(0,y.jsx)(b,{onApplyFilters:e=>{t(e)},onClearFilters:()=>{t({})},savedPresets:a,onSavePreset:(e,t)=>{const r={id:Date.now().toString(),name:e,filters:t},n=[...a,r];s(n),localStorage.setItem("filterPresets",JSON.stringify(n))},onLoadPreset:e=>{t(e.filters)}}),0===o?(0,y.jsx)("div",{className:"glass-card p-6 text-center",children:(0,y.jsx)("p",{className:"text-blue-400",children:'Görevleri görüntülemek için yukarıdaki filtrelerden en az birini seçin ve "Filtreleri Uygula" butonuna tıklayın.'})}):n?(0,y.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,y.jsx)(m,{size:"lg"})}):l?(0,y.jsx)("div",{className:"glass-card border-red-500/30 p-6 text-center",children:(0,y.jsx)("p",{className:"text-red-400",children:"Görevler yüklenirken bir hata oluştu."})}):(0,y.jsxs)("div",{className:"space-y-4",children:[(0,y.jsx)("div",{className:"glass-card p-4",children:(0,y.jsxs)("div",{className:"flex items-center justify-between",children:[(0,y.jsxs)("div",{children:[(0,y.jsx)("p",{className:"text-sm text-slate-400",children:"Toplam Sonuç"}),(0,y.jsx)("p",{className:"text-2xl font-bold text-white",children:r?.length||0})]}),(0,y.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,y.jsx)(_,{tasks:r||[]}),(0,y.jsx)("button",{onClick:()=>i(),className:"px-4 py-2 text-sm font-medium text-blue-400 hover:text-blue-300 transition-colors",children:"Yenile"})]})]})}),r&&r.length>0?(0,y.jsx)("div",{className:"glass-card overflow-hidden",children:(0,y.jsx)("div",{className:"divide-y divide-white/5",children:r.map(e=>(0,y.jsx)("div",{className:"p-4 hover:bg-white/5 transition-colors",children:(0,y.jsxs)("div",{className:"flex items-start justify-between",children:[(0,y.jsxs)("div",{className:"flex-1",children:[(0,y.jsx)("h3",{className:"text-lg font-medium text-white",children:e.title}),e.description&&(0,y.jsx)("p",{className:"mt-1 text-sm text-slate-400",children:e.description}),(0,y.jsxs)("div",{className:"mt-2 flex flex-wrap gap-2",children:[(0,y.jsx)("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${S[e.priority]||S.low}`,children:T[e.priority]||e.priority}),(0,y.jsx)("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${D[e.status]||D.not_started}`,children:C[e.status]||e.status}),e.assigned_to_profile&&(0,y.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-500/20 text-purple-400",children:e.assigned_to_profile.full_name})]})]}),(0,y.jsx)("div",{className:"ml-4 text-sm text-slate-500",children:e.due_date&&(0,y.jsxs)("p",{children:["Bitiş: ",new Date(e.due_date).toLocaleDateString("tr-TR")]})})]})},e.id))})}):(0,y.jsx)("div",{className:"glass-card p-6 text-center",children:(0,y.jsx)("p",{className:"text-slate-400",children:"Seçilen filtrelere uygun görev bulunamadı."})})]})]})})};export{R as Analytics};