import{D as e,G as t,H as s,J as a,K as r,Tt as n,U as l,o as i,p as o,x as d}from"./react-vendor-DnbmBACz.js";import"./supabase-vendor-CLitCmdP.js";import{i as c,t as m}from"./index-CDPVztAZ.js";import"./NotificationBell-DpekPiHl.js";import{t as x}from"./Layout-3NCdNaPA.js";import{n as u,t as p}from"./Modal-Dnx87MuO.js";import{t as h}from"./Card-Djhlbrke.js";var g=n(),b=a();const y=({onApplyFilters:e,onClearFilters:t,savedPresets:s=[],onSavePreset:a,onLoadPreset:r})=>{const[n,l]=(0,g.useState)(!1),[o,c]=(0,g.useState)({}),[m,x]=(0,g.useState)(""),[p,y]=(0,g.useState)(!1),f=(e,t)=>{c(s=>({...s,dateRange:{...s.dateRange,start:"start"===e?t:s.dateRange?.start||"",end:"end"===e?t:s.dateRange?.end||""}}))},j=(e,t)=>{c(s=>{const a=s[e]||[],r=a.includes(t)?a.filter(e=>e!==t):[...a,t];return{...s,[e]:r.length>0?r:void 0}})},v=Object.keys(o).filter(e=>{const t=o[e];return Array.isArray(t)?t.length>0:"object"==typeof t?Object.keys(t).length>0:!!t}).length;return(0,b.jsx)(h,{padding:"md",children:(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)(d,{className:"h-5 w-5 text-slate-400"}),(0,b.jsx)("h3",{className:"text-lg font-semibold text-white",children:"Gelişmiş Filtreler"}),v>0&&(0,b.jsxs)("span",{className:"px-2 py-1 text-xs font-semibold text-blue-800 bg-blue-100 rounded-full",children:[v," aktif"]})]}),(0,b.jsx)("button",{onClick:()=>l(!n),className:"text-sm font-medium text-blue-600 hover:text-blue-700",children:n?"Gizle":"Göster"})]}),s.length>0&&(0,b.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,b.jsx)("span",{className:"text-sm text-slate-400",children:"Kayıtlı Filtreler:"}),s.map(e=>(0,b.jsx)("button",{onClick:()=>(e=>{c(e.filters),r&&r(e)})(e),className:"px-3 py-1 text-sm font-medium text-slate-300 bg-slate-700 rounded-full hover:bg-slate-600 transition-colors",children:e.name},e.id))]}),n&&(0,b.jsxs)("div",{className:"space-y-4 pt-4 border-t border-white/10",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Tarih Aralığı"}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-xs text-slate-400 mb-1",children:"Başlangıç"}),(0,b.jsx)("input",{type:"date",value:o.dateRange?.start||"",onChange:e=>f("start",e.target.value),className:"w-full px-3 py-2 bg-slate-800 border border-white/10 text-white rounded-md focus:ring-blue-500 focus:border-blue-500"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-xs text-slate-400 mb-1",children:"Bitiş"}),(0,b.jsx)("input",{type:"date",value:o.dateRange?.end||"",onChange:e=>f("end",e.target.value),className:"w-full px-3 py-2 bg-slate-800 border border-white/10 text-white rounded-md focus:ring-blue-500 focus:border-blue-500"})]})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Durum"}),(0,b.jsx)("div",{className:"grid grid-cols-2 gap-2",children:["not_started","in_progress","completed","blocked"].map(e=>(0,b.jsxs)("label",{className:"flex items-center space-x-2",children:[(0,b.jsx)("input",{type:"checkbox",checked:(o.status||[]).includes(e),onChange:()=>j("status",e),className:"rounded border-slate-600 bg-slate-800 text-blue-500 focus:ring-blue-500"}),(0,b.jsxs)("span",{className:"text-sm text-slate-300",children:["not_started"===e&&"Başlamadı","in_progress"===e&&"Devam Ediyor","completed"===e&&"Tamamlandı","blocked"===e&&"Engellendi"]})]},e))})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Öncelik"}),(0,b.jsx)("div",{className:"grid grid-cols-2 gap-2",children:["low","medium","high","critical"].map(e=>(0,b.jsxs)("label",{className:"flex items-center space-x-2",children:[(0,b.jsx)("input",{type:"checkbox",checked:(o.priority||[]).includes(e),onChange:()=>j("priority",e),className:"rounded border-slate-600 bg-slate-800 text-blue-500 focus:ring-blue-500"}),(0,b.jsxs)("span",{className:"text-sm text-slate-300",children:["low"===e&&"Düşük","medium"===e&&"Orta","high"===e&&"Yüksek","critical"===e&&"Kritik"]})]},e))})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Kategori"}),(0,b.jsx)("div",{className:"grid grid-cols-2 gap-2",children:["routine","project","one_time","issue_resolution"].map(e=>(0,b.jsxs)("label",{className:"flex items-center space-x-2",children:[(0,b.jsx)("input",{type:"checkbox",checked:(o.category||[]).includes(e),onChange:()=>j("category",e),className:"rounded border-slate-600 bg-slate-800 text-blue-500 focus:ring-blue-500"}),(0,b.jsxs)("span",{className:"text-sm text-slate-300",children:["routine"===e&&"Rutin","project"===e&&"Proje","one_time"===e&&"Tek Seferlik","issue_resolution"===e&&"Sorun Çözümü"]})]},e))})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between pt-4 border-t border-white/10",children:[(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)(u,{variant:"primary",onClick:()=>{e(o),l(!1)},children:"Filtreleri Uygula"}),(0,b.jsxs)(u,{variant:"secondary",onClick:()=>{c({}),t()},children:[(0,b.jsx)(i,{className:"h-4 w-4 mr-1"}),"Temizle"]})]}),a&&(0,b.jsx)("button",{onClick:()=>y(!p),className:"text-sm font-medium text-blue-600 hover:text-blue-700",children:"Filtreyi Kaydet"})]}),p&&a&&(0,b.jsxs)("div",{className:"flex items-center space-x-2 pt-2",children:[(0,b.jsx)("input",{type:"text",value:m,onChange:e=>x(e.target.value),placeholder:"Filtre adı...",className:"flex-1 px-3 py-2 bg-slate-800 border border-white/10 text-white rounded-md focus:ring-blue-500 focus:border-blue-500"}),(0,b.jsx)(u,{variant:"primary",onClick:()=>{m.trim()&&a&&(a(m.trim(),o),x(""),y(!1))},disabled:!m.trim(),children:"Kaydet"})]})]})]})})},f=(e,t="tasks-export.csv")=>{const s=e.map(e=>[e.id,e.title,e.description||"",v(e.category),k(e.priority),N(e.status),e.progress_percentage,e.assigned_to_profile?.full_name||"",e.created_by_profile?.full_name||"",e.due_date?new Date(e.due_date).toLocaleDateString("tr-TR"):"",new Date(e.created_at).toLocaleDateString("tr-TR"),new Date(e.updated_at).toLocaleDateString("tr-TR")]),a=[["ID","Başlık","Açıklama","Kategori","Öncelik","Durum","İlerleme (%)","Atanan Kişi","Oluşturan","Bitiş Tarihi","Oluşturulma Tarihi","Güncellenme Tarihi"].join(","),...s.map(e=>e.map(e=>`"${String(e).replace(/"/g,'""')}"`).join(","))].join("\n"),r=new Blob(["\ufeff"+a],{type:"text/csv;charset=utf-8;"}),n=document.createElement("a"),l=URL.createObjectURL(r);n.setAttribute("href",l),n.setAttribute("download",t),n.style.visibility="hidden",document.body.appendChild(n),n.click(),document.body.removeChild(n)},j=(e,t="tasks-report.pdf")=>{const s=`\n    <!DOCTYPE html>\n    <html>\n    <head>\n      <meta charset="UTF-8">\n      <title>Görev Raporu</title>\n      <style>\n        body {\n          font-family: Arial, sans-serif;\n          margin: 20px;\n          color: #333;\n        }\n        h1 {\n          color: #2563eb;\n          border-bottom: 2px solid #2563eb;\n          padding-bottom: 10px;\n        }\n        .summary {\n          background: #f3f4f6;\n          padding: 15px;\n          border-radius: 8px;\n          margin: 20px 0;\n        }\n        .summary-item {\n          display: inline-block;\n          margin-right: 30px;\n        }\n        table {\n          width: 100%;\n          border-collapse: collapse;\n          margin-top: 20px;\n        }\n        th {\n          background: #2563eb;\n          color: white;\n          padding: 12px;\n          text-align: left;\n          font-weight: 600;\n        }\n        td {\n          padding: 10px;\n          border-bottom: 1px solid #e5e7eb;\n        }\n        tr:hover {\n          background: #f9fafb;\n        }\n        .priority-critical { color: #dc2626; font-weight: bold; }\n        .priority-high { color: #ea580c; font-weight: bold; }\n        .priority-medium { color: #ca8a04; }\n        .priority-low { color: #16a34a; }\n        .status-completed { color: #16a34a; }\n        .status-in-progress { color: #2563eb; }\n        .status-blocked { color: #dc2626; }\n        .footer {\n          margin-top: 30px;\n          text-align: center;\n          color: #6b7280;\n          font-size: 12px;\n        }\n      </style>\n    </head>\n    <body>\n      <h1>Görev Raporu</h1>\n      <p>Oluşturulma Tarihi: ${(new Date).toLocaleDateString("tr-TR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}</p>\n      \n      <div class="summary">\n        <div class="summary-item">\n          <strong>Toplam Görev:</strong> ${e.length}\n        </div>\n        <div class="summary-item">\n          <strong>Tamamlanan:</strong> ${e.filter(e=>"completed"===e.status).length}\n        </div>\n        <div class="summary-item">\n          <strong>Devam Eden:</strong> ${e.filter(e=>"in_progress"===e.status).length}\n        </div>\n        <div class="summary-item">\n          <strong>Tamamlanma Oranı:</strong> ${Math.round(e.filter(e=>"completed"===e.status).length/e.length*100)}%\n        </div>\n      </div>\n\n      <table>\n        <thead>\n          <tr>\n            <th>Başlık</th>\n            <th>Kategori</th>\n            <th>Öncelik</th>\n            <th>Durum</th>\n            <th>İlerleme</th>\n            <th>Atanan</th>\n            <th>Bitiş Tarihi</th>\n          </tr>\n        </thead>\n        <tbody>\n          ${e.map(e=>`\n            <tr>\n              <td><strong>${w(e.title)}</strong></td>\n              <td>${v(e.category)}</td>\n              <td class="priority-${e.priority}">${k(e.priority)}</td>\n              <td class="status-${e.status.replace("_","-")}">${N(e.status)}</td>\n              <td>${e.progress_percentage}%</td>\n              <td>${w(e.assigned_to_profile?.full_name||"-")}</td>\n              <td>${e.due_date?new Date(e.due_date).toLocaleDateString("tr-TR"):"-"}</td>\n            </tr>\n          `).join("")}\n        </tbody>\n      </table>\n\n      <div class="footer">\n        <p>Modern Office System - Görev Yönetim Raporu</p>\n      </div>\n    </body>\n    </html>\n  `,a=window.open("","_blank");a&&(a.document.write(s),a.document.close(),a.onload=()=>{a.print()})};function v(e){return{routine:"Rutin",project:"Proje",one_time:"Tek Seferlik",issue_resolution:"Sorun Çözümü"}[e]||e}function k(e){return{low:"Düşük",medium:"Orta",high:"Yüksek",critical:"Kritik"}[e]||e}function N(e){return{not_started:"Başlamadı",in_progress:"Devam Ediyor",completed:"Tamamlandı",blocked:"Engellendi"}[e]||e}function w(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}const _=({tasks:a,disabled:r=!1})=>{const[n,i]=(0,g.useState)(!1),[d,c]=(0,g.useState)(["title","category","priority","status","assigned_to_profile","due_date"]),m=()=>{f(a,`gorevler-${(new Date).toISOString().split("T")[0]}.csv`)},x=()=>{j(a,`gorev-raporu-${(new Date).toISOString().split("T")[0]}.pdf`)},h=e=>{const t="csv"===e?`gorevler-ozel-${(new Date).toISOString().split("T")[0]}.csv`:`gorev-raporu-ozel-${(new Date).toISOString().split("T")[0]}.pdf`;"csv"===e?f(a,t):j(a,t),i(!1)};return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(l,{as:"div",className:"relative inline-block text-left",children:[(0,b.jsxs)(l.Button,{as:u,variant:"secondary",disabled:r||0===a.length,children:[(0,b.jsx)(s,{className:"h-5 w-5 mr-2"}),"Dışa Aktar"]}),(0,b.jsx)(t,{as:g.Fragment,enter:"transition ease-out duration-100",enterFrom:"transform opacity-0 scale-95",enterTo:"transform opacity-100 scale-100",leave:"transition ease-in duration-75",leaveFrom:"transform opacity-100 scale-100",leaveTo:"transform opacity-0 scale-95",children:(0,b.jsx)(l.Items,{className:"absolute right-0 z-10 mt-2 w-56 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none",children:(0,b.jsxs)("div",{className:"py-1",children:[(0,b.jsx)(l.Item,{children:({active:e})=>(0,b.jsxs)("button",{onClick:m,className:(e?"bg-gray-100 text-gray-900":"text-gray-700")+" group flex items-center w-full px-4 py-2 text-sm",children:[(0,b.jsx)(o,{className:"mr-3 h-5 w-5 text-gray-400"}),"CSV olarak indir"]})}),(0,b.jsx)(l.Item,{children:({active:t})=>(0,b.jsxs)("button",{onClick:x,className:(t?"bg-gray-100 text-gray-900":"text-gray-700")+" group flex items-center w-full px-4 py-2 text-sm",children:[(0,b.jsx)(e,{className:"mr-3 h-5 w-5 text-gray-400"}),"PDF raporu oluştur"]})}),(0,b.jsx)("div",{className:"border-t border-gray-100 my-1"}),(0,b.jsx)(l.Item,{children:({active:e})=>(0,b.jsxs)("button",{onClick:()=>i(!0),className:(e?"bg-gray-100 text-gray-900":"text-gray-700")+" group flex items-center w-full px-4 py-2 text-sm",children:[(0,b.jsx)(s,{className:"mr-3 h-5 w-5 text-gray-400"}),"Özel rapor oluştur"]})})]})})})]}),(0,b.jsx)(p,{isOpen:n,onClose:()=>i(!1),title:"Özel Rapor Oluştur",children:(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("p",{className:"text-sm text-gray-600",children:"Rapora dahil etmek istediğiniz alanları seçin:"}),(0,b.jsx)("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:[{key:"title",label:"Başlık"},{key:"description",label:"Açıklama"},{key:"category",label:"Kategori"},{key:"priority",label:"Öncelik"},{key:"status",label:"Durum"},{key:"progress_percentage",label:"İlerleme"},{key:"assigned_to_profile",label:"Atanan Kişi"},{key:"created_by_profile",label:"Oluşturan"},{key:"due_date",label:"Bitiş Tarihi"},{key:"created_at",label:"Oluşturulma Tarihi"},{key:"updated_at",label:"Güncellenme Tarihi"}].map(e=>(0,b.jsxs)("label",{className:"flex items-center space-x-2",children:[(0,b.jsx)("input",{type:"checkbox",checked:d.includes(e.key),onChange:()=>{return t=e.key,void c(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t]);var t},className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),(0,b.jsx)("span",{className:"text-sm text-gray-700",children:e.label})]},e.key))}),(0,b.jsxs)("div",{className:"pt-4 border-t border-gray-200",children:[(0,b.jsx)("p",{className:"text-sm text-gray-600 mb-3",children:"Format seçin:"}),(0,b.jsxs)("div",{className:"flex space-x-3",children:[(0,b.jsxs)(u,{variant:"secondary",onClick:()=>h("csv"),disabled:0===d.length,children:[(0,b.jsx)(o,{className:"h-5 w-5 mr-2"}),"CSV"]}),(0,b.jsxs)(u,{variant:"secondary",onClick:()=>h("pdf"),disabled:0===d.length,children:[(0,b.jsx)(e,{className:"h-5 w-5 mr-2"}),"PDF"]})]})]}),(0,b.jsx)("div",{className:"flex justify-end pt-4 border-t border-gray-200",children:(0,b.jsx)(u,{variant:"secondary",onClick:()=>i(!1),children:"İptal"})})]})})]})};var S={critical:"bg-red-500/20 text-red-400",high:"bg-orange-500/20 text-orange-400",medium:"bg-amber-500/20 text-amber-400",low:"bg-slate-500/20 text-slate-400"},D={completed:"bg-emerald-500/20 text-emerald-400",in_progress:"bg-blue-500/20 text-blue-400",blocked:"bg-red-500/20 text-red-400",not_started:"bg-slate-500/20 text-slate-400"},T={critical:"Kritik",high:"Yüksek",medium:"Orta",low:"Düşük"},C={completed:"Tamamlandı",in_progress:"Devam Ediyor",blocked:"Engellendi",not_started:"Başlamadı"};const R=()=>{const[e,t]=(0,g.useState)({}),[s,a]=(0,g.useState)(()=>{const e=localStorage.getItem("filterPresets");return e?JSON.parse(e):[]}),{data:n,isLoading:l,error:i,refetch:o}=r({queryKey:["filtered-tasks",e],queryFn:()=>(async e=>{const{data:{session:t}}=await c.auth.getSession();if(!t)throw new Error("No active session");const s=new URLSearchParams;e.status&&e.status.length>0&&e.status.forEach(e=>s.append("status",e)),e.priority&&e.priority.length>0&&e.priority.forEach(e=>s.append("priority",e)),e.category&&e.category.length>0&&e.category.forEach(e=>s.append("category",e)),e.assignedTo&&s.append("assigned_to",e.assignedTo),e.createdBy&&s.append("created_by",e.createdBy);const a=await fetch(`http://localhost:3001/api/tasks?${s.toString()}`,{headers:{Authorization:`Bearer ${t.access_token}`}});if(!a.ok)throw new Error("Failed to fetch filtered tasks");let r=(await a.json()).data||[];return(e.dateRange?.start||e.dateRange?.end)&&(r=r.filter(t=>{const s=new Date(t.created_at);if(e.dateRange?.start&&s<new Date(e.dateRange.start))return!1;if(e.dateRange?.end){const t=new Date(e.dateRange.end);if(t.setHours(23,59,59,999),s>t)return!1}return!0})),r})(e),enabled:Object.keys(e).length>0}),d=Object.keys(e).filter(t=>{const s=e[t];return Array.isArray(s)?s.length>0:"object"==typeof s?Object.keys(s).length>0:!!s}).length;return(0,b.jsx)(x,{children:(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-2xl font-bold text-white",children:"Analitik ve Raporlama"}),(0,b.jsx)("p",{className:"mt-1 text-sm text-slate-400",children:"Gelişmiş filtreler ile görevleri analiz edin ve raporlayın"})]}),(0,b.jsx)(y,{onApplyFilters:e=>{t(e)},onClearFilters:()=>{t({})},savedPresets:s,onSavePreset:(e,t)=>{const r={id:Date.now().toString(),name:e,filters:t},n=[...s,r];a(n),localStorage.setItem("filterPresets",JSON.stringify(n))},onLoadPreset:e=>{t(e.filters)}}),0===d?(0,b.jsx)("div",{className:"glass-card p-6 text-center",children:(0,b.jsx)("p",{className:"text-blue-400",children:'Görevleri görüntülemek için yukarıdaki filtrelerden en az birini seçin ve "Filtreleri Uygula" butonuna tıklayın.'})}):l?(0,b.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,b.jsx)(m,{size:"lg"})}):i?(0,b.jsx)("div",{className:"glass-card border-red-500/30 p-6 text-center",children:(0,b.jsx)("p",{className:"text-red-400",children:"Görevler yüklenirken bir hata oluştu."})}):(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("div",{className:"glass-card p-4",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-slate-400",children:"Toplam Sonuç"}),(0,b.jsx)("p",{className:"text-2xl font-bold text-white",children:n?.length||0})]}),(0,b.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,b.jsx)(_,{tasks:n||[]}),(0,b.jsx)("button",{onClick:()=>o(),className:"px-4 py-2 text-sm font-medium text-blue-400 hover:text-blue-300 transition-colors",children:"Yenile"})]})]})}),n&&n.length>0?(0,b.jsx)("div",{className:"glass-card overflow-hidden",children:(0,b.jsx)("div",{className:"divide-y divide-white/5",children:n.map(e=>(0,b.jsx)("div",{className:"p-4 hover:bg-white/5 transition-colors",children:(0,b.jsxs)("div",{className:"flex items-start justify-between",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("h3",{className:"text-lg font-medium text-white",children:e.title}),e.description&&(0,b.jsx)("p",{className:"mt-1 text-sm text-slate-400",children:e.description}),(0,b.jsxs)("div",{className:"mt-2 flex flex-wrap gap-2",children:[(0,b.jsx)("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${S[e.priority]||S.low}`,children:T[e.priority]||e.priority}),(0,b.jsx)("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${D[e.status]||D.not_started}`,children:C[e.status]||e.status}),e.assigned_to_profile&&(0,b.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-500/20 text-purple-400",children:e.assigned_to_profile.full_name})]})]}),(0,b.jsx)("div",{className:"ml-4 text-sm text-slate-500",children:e.due_date&&(0,b.jsxs)("p",{children:["Bitiş: ",new Date(e.due_date).toLocaleDateString("tr-TR")]})})]})},e.id))})}):(0,b.jsx)("div",{className:"glass-card p-6 text-center",children:(0,b.jsx)("p",{className:"text-slate-400",children:"Seçilen filtrelere uygun görev bulunamadı."})})]})]})})};export{R as Analytics};