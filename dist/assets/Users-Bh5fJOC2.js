import{O as e,T as t,b as l,c as s,et as a,f as r,g as n,h as i,jt as o,l as d,o as c,v as m,w as u}from"./react-vendor-2hQaKJT0.js";import"./supabase-vendor-CLitCmdP.js";import{a as x,i as h,t as p}from"./index-4_19cBdp.js";import"./NotificationBell-DOonUTZz.js";import{t as b}from"./Layout-Dciw3jEd.js";var f=o(),j=a();const g=({isOpen:e,onClose:l,onUserCreated:s})=>{const[a,r]=(0,f.useState)(!1),[n,i]=(0,f.useState)(null),[o,m]=(0,f.useState)(!1),[h,p]=(0,f.useState)({email:"",password:"",full_name:"",role:"employee",department:""}),b=e=>{const{name:t,value:l}=e.target;p(e=>({...e,[t]:l})),i(null)};return e?(0,j.jsxs)("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:[(0,j.jsx)("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm",onClick:l}),(0,j.jsx)("div",{className:"flex min-h-full items-center justify-center p-4",children:(0,j.jsxs)("div",{className:"relative w-full max-w-md transform rounded-2xl bg-slate-900 border border-white/10 p-6 shadow-xl transition-all",children:[(0,j.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,j.jsxs)("div",{className:"flex items-center gap-3",children:[(0,j.jsx)("div",{className:"p-2 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl",children:(0,j.jsx)(d,{className:"w-6 h-6 text-white"})}),(0,j.jsx)("h2",{className:"text-xl font-bold text-white",children:"Yeni Kullanıcı Oluştur"})]}),(0,j.jsx)("button",{onClick:l,className:"p-2 rounded-lg hover:bg-white/10 transition-colors",children:(0,j.jsx)(c,{className:"w-5 h-5 text-slate-400"})})]}),n&&(0,j.jsx)("div",{className:"mb-4 p-3 bg-red-500/10 border border-red-500/20 rounded-lg",children:(0,j.jsx)("p",{className:"text-sm text-red-400",children:n})}),(0,j.jsxs)("form",{onSubmit:async e=>{e.preventDefault(),r(!0),i(null);try{const{data:{session:e}}=await x.auth.getSession();if(!e)throw new Error("Oturum bulunamadı");const t=await fetch("http://localhost:3001/api/users/create",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e?.access_token}`},body:JSON.stringify(h)}),a=await t.json();if(!t.ok)throw new Error(a.message||"Kullanıcı oluşturulamadı");p({email:"",password:"",full_name:"",role:"employee",department:""}),s(),l()}catch(t){i(t instanceof Error?t.message:"Bir hata oluştu")}finally{r(!1)}},className:"space-y-4",children:[(0,j.jsxs)("div",{children:[(0,j.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-1.5",children:"Ad Soyad *"}),(0,j.jsx)("input",{type:"text",name:"full_name",value:h.full_name,onChange:b,required:!0,placeholder:"Örn: Ahmet Yılmaz",className:"w-full px-4 py-2.5 bg-slate-800 border border-white/10 rounded-lg text-white placeholder-slate-500 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 outline-none transition-colors"})]}),(0,j.jsxs)("div",{children:[(0,j.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-1.5",children:"Email *"}),(0,j.jsx)("input",{type:"email",name:"email",value:h.email,onChange:b,required:!0,placeholder:"ornek@sirket.com",className:"w-full px-4 py-2.5 bg-slate-800 border border-white/10 rounded-lg text-white placeholder-slate-500 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 outline-none transition-colors"})]}),(0,j.jsxs)("div",{children:[(0,j.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-1.5",children:"Şifre *"}),(0,j.jsxs)("div",{className:"relative",children:[(0,j.jsx)("input",{type:o?"text":"password",name:"password",value:h.password,onChange:b,required:!0,minLength:6,placeholder:"En az 6 karakter",className:"w-full px-4 py-2.5 pr-12 bg-slate-800 border border-white/10 rounded-lg text-white placeholder-slate-500 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 outline-none transition-colors"}),(0,j.jsx)("button",{type:"button",onClick:()=>m(!o),className:"absolute right-3 top-1/2 -translate-y-1/2 p-1 hover:bg-white/10 rounded transition-colors",children:o?(0,j.jsx)(t,{className:"w-5 h-5 text-slate-400"}):(0,j.jsx)(u,{className:"w-5 h-5 text-slate-400"})})]})]}),(0,j.jsxs)("div",{children:[(0,j.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-1.5",children:"Rol"}),(0,j.jsxs)("select",{name:"role",value:h.role,onChange:b,className:"w-full px-4 py-2.5 bg-slate-800 border border-white/10 rounded-lg text-white focus:border-blue-500 focus:ring-1 focus:ring-blue-500 outline-none transition-colors",children:[(0,j.jsx)("option",{value:"employee",children:"Çalışan"}),(0,j.jsx)("option",{value:"admin",children:"Admin"})]})]}),(0,j.jsxs)("div",{children:[(0,j.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-1.5",children:"Departman"}),(0,j.jsx)("input",{type:"text",name:"department",value:h.department,onChange:b,placeholder:"Örn: Satış, Muhasebe, IT",className:"w-full px-4 py-2.5 bg-slate-800 border border-white/10 rounded-lg text-white placeholder-slate-500 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 outline-none transition-colors"})]}),(0,j.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,j.jsx)("button",{type:"button",onClick:l,className:"flex-1 px-4 py-2.5 bg-slate-800 border border-white/10 rounded-lg text-white font-medium hover:bg-slate-700 transition-colors",children:"İptal"}),(0,j.jsx)("button",{type:"submit",disabled:a,className:"flex-1 px-4 py-2.5 bg-gradient-to-r from-blue-600 to-purple-600 rounded-lg text-white font-medium hover:from-blue-500 hover:to-purple-500 disabled:opacity-50 disabled:cursor-not-allowed transition-all",children:a?"Oluşturuluyor...":"Oluştur"})]})]})]})})]}):null},w=()=>{const{isAdmin:t}=h(),[a,o]=(0,f.useState)([]),[d,c]=(0,f.useState)(!0),[u,w]=(0,f.useState)(""),[v,y]=(0,f.useState)("all"),[N,k]=(0,f.useState)(!1),[C,S]=(0,f.useState)(null),[_,z]=(0,f.useState)(""),[E,O]=(0,f.useState)(!1);(0,f.useEffect)(()=>{T()},[]);const T=async()=>{try{c(!0);const{data:e,error:t}=await x.from("profiles").select("*").order("full_name",{ascending:!0});if(t)throw t;o(e||[])}catch(e){}finally{c(!1)}},A=a.filter(e=>{const t=e.full_name?.toLowerCase().includes(u.toLowerCase())||e.email?.toLowerCase().includes(u.toLowerCase()),l="all"===v||e.role===v;return t&&l}),K={admin:"bg-purple-500/20 text-purple-400",employee:"bg-blue-500/20 text-blue-400"};return t?(0,j.jsxs)(b,{children:[(0,j.jsxs)("div",{className:"space-y-6",children:[(0,j.jsxs)("div",{className:"flex items-center justify-between",children:[(0,j.jsxs)("div",{children:[(0,j.jsx)("h1",{className:"text-2xl font-bold text-white",children:"Kullanıcı Yönetimi"}),(0,j.jsx)("p",{className:"mt-1 text-sm text-slate-400",children:"Tüm kullanıcıları görüntüleyin ve rollerini yönetin"})]}),(0,j.jsxs)("div",{className:"flex items-center gap-4",children:[(0,j.jsxs)("div",{className:"text-right",children:[(0,j.jsx)("p",{className:"text-2xl font-bold text-white",children:a.length}),(0,j.jsx)("p",{className:"text-sm text-slate-400",children:"Toplam Kullanıcı"})]}),(0,j.jsxs)("button",{onClick:()=>k(!0),className:"flex items-center gap-2 px-4 py-2.5 bg-gradient-to-r from-blue-600 to-purple-600 rounded-xl text-white font-medium hover:from-blue-500 hover:to-purple-500 hover:shadow-lg hover:shadow-blue-500/25 transition-all",children:[(0,j.jsx)(n,{className:"w-5 h-5"}),"Yeni Kullanıcı"]})]})]}),(0,j.jsx)("div",{className:"glass-card p-4",children:(0,j.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4",children:[(0,j.jsxs)("div",{className:"relative flex-1",children:[(0,j.jsx)(m,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"}),(0,j.jsx)("input",{type:"text",placeholder:"İsim veya email ara...",value:u,onChange:e=>w(e.target.value),className:"w-full pl-10 pr-4 py-2.5 bg-slate-800 border border-white/10 rounded-lg text-white placeholder-slate-500 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 outline-none transition-colors"})]}),(0,j.jsxs)("select",{value:v,onChange:e=>y(e.target.value),className:"px-4 py-2.5 bg-slate-800 border border-white/10 rounded-lg text-white focus:border-blue-500 focus:ring-1 focus:ring-blue-500 outline-none transition-colors",children:[(0,j.jsx)("option",{value:"all",children:"Tüm Roller"}),(0,j.jsx)("option",{value:"admin",children:"Admin"}),(0,j.jsx)("option",{value:"employee",children:"Çalışan"})]})]})}),d?(0,j.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,j.jsx)(p,{size:"lg"})}):0===A.length?(0,j.jsxs)("div",{className:"glass-card p-8 text-center",children:[(0,j.jsx)(s,{className:"w-12 h-12 text-slate-500 mx-auto mb-4"}),(0,j.jsx)("p",{className:"text-slate-400",children:"Kullanıcı bulunamadı"})]}):(0,j.jsx)("div",{className:"glass-card overflow-hidden",children:(0,j.jsx)("div",{className:"divide-y divide-white/5",children:A.map(t=>(0,j.jsx)("div",{className:"p-4 hover:bg-white/5 transition-colors",children:(0,j.jsxs)("div",{className:"flex items-center justify-between",children:[(0,j.jsxs)("div",{className:"flex items-center gap-4",children:[t.avatar_url?(0,j.jsx)("img",{src:t.avatar_url,alt:t.full_name,className:"w-12 h-12 rounded-xl object-cover border border-white/10"}):(0,j.jsx)("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center",children:(0,j.jsx)("span",{className:"text-lg font-bold text-white",children:t.full_name?.charAt(0).toUpperCase()||"?"})}),(0,j.jsxs)("div",{children:[(0,j.jsx)("h3",{className:"text-white font-medium",children:t.full_name}),(0,j.jsxs)("div",{className:"flex items-center gap-2 text-sm text-slate-400",children:[(0,j.jsx)(e,{className:"w-4 h-4"}),t.email]}),t.department&&(0,j.jsx)("p",{className:"text-xs text-slate-500 mt-0.5",children:t.department})]})]}),(0,j.jsxs)("div",{className:"flex items-center gap-4",children:[(0,j.jsx)("span",{className:`px-3 py-1 text-xs font-semibold rounded-full ${K[t.role]||K.employee}`,children:"admin"===t.role?"Admin":"Çalışan"}),(0,j.jsxs)("select",{value:t.role,onChange:e=>(async(e,t)=>{try{const{error:l}=await x.from("profiles").update({role:t}).eq("id",e);if(l)throw l;o(a.map(l=>l.id===e?{...l,role:t}:l))}catch(l){}})(t.id,e.target.value),className:"px-3 py-1.5 bg-slate-800 border border-white/10 rounded-lg text-sm text-white focus:border-blue-500 outline-none",children:[(0,j.jsx)("option",{value:"employee",children:"Çalışan"}),(0,j.jsx)("option",{value:"admin",children:"Admin"})]}),(0,j.jsx)("button",{type:"button",onClick:e=>{e.stopPropagation(),e.preventDefault(),S({id:t.id,name:t.full_name})},className:"p-2 text-yellow-400 hover:text-yellow-300 hover:bg-yellow-500/10 rounded-lg transition-colors cursor-pointer",title:"Şifre Sıfırla",children:(0,j.jsx)(l,{className:"w-5 h-5 pointer-events-none"})}),(0,j.jsx)("button",{type:"button",onClick:e=>{e.stopPropagation(),e.preventDefault(),(async(e,t)=>{setTimeout(async()=>{if(window.confirm(`"${t}" kullanıcısını silmek istediğinizden emin misiniz? Bu işlem geri alınamaz.`))try{const{data:{session:t}}=await x.auth.getSession();if(!t)return void alert("Oturum bulunamadı");const l=await fetch(`http://localhost:3001/api/users/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${t.access_token}`,"Content-Type":"application/json"}}),s=await l.json();if(!l.ok)throw new Error(s.message||"Kullanıcı silinemedi");o(t=>t.filter(t=>t.id!==e)),alert("Kullanıcı başarıyla silindi")}catch(l){alert(l instanceof Error?l.message:"Kullanıcı silinemedi")}},0)})(t.id,t.full_name)},className:"p-2 text-red-400 hover:text-red-300 hover:bg-red-500/10 rounded-lg transition-colors cursor-pointer",title:"Kullanıcıyı Sil",children:(0,j.jsx)(r,{className:"w-5 h-5 pointer-events-none"})})]})]})},t.id))})})]}),(0,j.jsx)(g,{isOpen:N,onClose:()=>k(!1),onUserCreated:T}),C&&(0,j.jsxs)("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:[(0,j.jsx)("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm",onClick:()=>{S(null),z("")}}),(0,j.jsx)("div",{className:"flex min-h-full items-center justify-center p-4",children:(0,j.jsxs)("div",{className:"relative w-full max-w-md transform rounded-2xl bg-slate-900 border border-white/10 p-6 shadow-xl transition-all",children:[(0,j.jsxs)("div",{className:"flex items-center gap-3 mb-6",children:[(0,j.jsx)("div",{className:"p-2 bg-gradient-to-br from-yellow-500 to-orange-600 rounded-xl",children:(0,j.jsx)(l,{className:"w-6 h-6 text-white"})}),(0,j.jsxs)("div",{children:[(0,j.jsx)("h2",{className:"text-xl font-bold text-white",children:"Şifre Sıfırla"}),(0,j.jsx)("p",{className:"text-sm text-slate-400",children:C.name})]})]}),(0,j.jsxs)("div",{className:"space-y-4",children:[(0,j.jsxs)("div",{children:[(0,j.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-1.5",children:"Yeni Şifre"}),(0,j.jsx)("input",{type:"text",value:_,onChange:e=>z(e.target.value),placeholder:"En az 6 karakter",className:"w-full px-4 py-2.5 bg-slate-800 border border-white/10 rounded-lg text-white placeholder-slate-500 focus:border-yellow-500 focus:ring-1 focus:ring-yellow-500 outline-none transition-colors"})]}),(0,j.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,j.jsx)("button",{type:"button",onClick:()=>{S(null),z("")},className:"flex-1 px-4 py-2.5 bg-slate-800 border border-white/10 rounded-lg text-white font-medium hover:bg-slate-700 transition-colors",children:"İptal"}),(0,j.jsx)("button",{type:"button",onClick:async()=>{if(C&&_)if(_.length<6)alert("Şifre en az 6 karakter olmalıdır");else{O(!0);try{const{data:{session:e}}=await x.auth.getSession();if(!e)return void alert("Oturum bulunamadı");const t=await fetch(`http://localhost:3001/api/users/${C.id}/reset-password`,{method:"PUT",headers:{Authorization:`Bearer ${e.access_token}`,"Content-Type":"application/json"},body:JSON.stringify({password:_})}),l=await t.json();if(!t.ok)throw new Error(l.message||"Şifre sıfırlanamadı");alert(`${C.name} kullanıcısının şifresi başarıyla değiştirildi`),S(null),z("")}catch(e){alert(e instanceof Error?e.message:"Şifre sıfırlanamadı")}finally{O(!1)}}},disabled:E||_.length<6,className:"flex-1 px-4 py-2.5 bg-gradient-to-r from-yellow-600 to-orange-600 rounded-lg text-white font-medium hover:from-yellow-500 hover:to-orange-500 disabled:opacity-50 disabled:cursor-not-allowed transition-all",children:E?"Sıfırlanıyor...":"Şifreyi Değiştir"})]})]})]})})]})]}):(0,j.jsx)(b,{children:(0,j.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,j.jsxs)("div",{className:"glass-card p-8 text-center",children:[(0,j.jsx)(i,{className:"w-12 h-12 text-red-400 mx-auto mb-4"}),(0,j.jsx)("h2",{className:"text-xl font-semibold text-white mb-2",children:"Yetkisiz Erişim"}),(0,j.jsx)("p",{className:"text-slate-400",children:"Bu sayfayı görüntüleme yetkiniz yok."})]})})})};export{w as Users};