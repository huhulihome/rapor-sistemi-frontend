import{n as e}from"./rolldown-runtime-A1xW-pDA.js";import{Dt as s,d as t,et as a,g as l,jt as r,p as i}from"./react-vendor-2hQaKJT0.js";import"./supabase-vendor-CLitCmdP.js";import{a as n,i as o,r as d,t as c}from"./index-B1OELnp-.js";import"./NotificationBell-CcWohExe.js";import{t as m}from"./Layout-3bhG6fzF.js";import{n as x}from"./Modal-DnIZetdV.js";import"./Input-KXeAtq1L.js";import"./Card-CSBg1RCz.js";import"./common-BfzthswH.js";import"./TaskDetail-ZPk0ECqU.js";import"./TaskForm-DLTBLnEd.js";var u=e(r(),1),h=a(),p={low:"bg-slate-500/20 text-slate-300",medium:"bg-blue-500/20 text-blue-400",high:"bg-orange-500/20 text-orange-400",critical:"bg-red-500/20 text-red-400"},g={not_started:"bg-slate-500/20 text-slate-300",in_progress:"bg-blue-500/20 text-blue-400",completed:"bg-emerald-500/20 text-emerald-400",blocked:"bg-red-500/20 text-red-400"},j={routine:"Rutin",project:"Proje",one_time:"Tek Seferlik",issue_resolution:"Sorun Çözümü"},v={not_started:"Başlamadı",in_progress:"Devam Ediyor",completed:"Tamamlandı",blocked:"Engellendi"};const b=({task:e,onClick:s,showAssignee:a=!1})=>{const l=e.due_date&&new Date(e.due_date)<new Date&&"completed"!==e.status,r=e.assigned_user?.full_name||e.profiles?.full_name||null;return(0,h.jsxs)("div",{onClick:s,className:d("glass-card p-5 rounded-xl cursor-pointer transition-all duration-300","hover:scale-[1.02] hover:shadow-xl hover:shadow-blue-500/10",l?"border-l-4 border-l-red-500":""),children:[(0,h.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,h.jsx)("h3",{className:"text-lg font-semibold text-white flex-1 pr-2",children:e.title}),(0,h.jsx)("span",{className:d("px-2.5 py-1 text-xs font-medium rounded-full",p[e.priority]),children:e.priority.toUpperCase()})]}),e.description&&(0,h.jsx)("p",{className:"text-sm text-slate-400 mb-4 line-clamp-2",children:e.description}),(0,h.jsxs)("div",{className:"flex flex-wrap gap-2 mb-4",children:[(0,h.jsx)("span",{className:d("px-2.5 py-1 text-xs font-medium rounded-full",g[e.status]),children:v[e.status]}),(0,h.jsx)("span",{className:"px-2.5 py-1 text-xs font-medium rounded-full bg-purple-500/20 text-purple-400",children:j[e.category]})]}),a&&r&&(0,h.jsxs)("div",{className:"flex items-center gap-2 mb-3 text-sm",children:[(0,h.jsx)(t,{className:"w-4 h-4 text-slate-400"}),(0,h.jsx)("span",{className:"text-slate-300",children:r})]}),e.progress_percentage>0&&(0,h.jsxs)("div",{className:"mb-4",children:[(0,h.jsxs)("div",{className:"flex justify-between text-xs text-slate-400 mb-1",children:[(0,h.jsx)("span",{children:"İlerleme"}),(0,h.jsxs)("span",{className:"text-white font-medium",children:[e.progress_percentage,"%"]})]}),(0,h.jsx)("div",{className:"w-full bg-slate-700 rounded-full h-2 overflow-hidden",children:(0,h.jsx)("div",{className:"bg-gradient-to-r from-blue-500 to-emerald-500 h-2 rounded-full transition-all duration-500",style:{width:`${e.progress_percentage}%`}})})]}),(0,h.jsxs)("div",{className:"flex items-center justify-between text-xs text-slate-500",children:[e.due_date&&(0,h.jsxs)("div",{className:d("flex items-center gap-1",l?"text-red-400 font-medium":""),children:[(0,h.jsx)("svg",{className:"w-4 h-4 [&>path]:stroke-current",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,h.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),new Date(e.due_date).toLocaleDateString("tr-TR"),e.end_time&&(0,h.jsx)("span",{className:"ml-1 text-slate-400",children:e.end_time.substring(0,5)})]}),e.tags&&e.tags.length>0&&(0,h.jsxs)("div",{className:"flex gap-1",children:[e.tags.slice(0,2).map((e,s)=>(0,h.jsx)("span",{className:"px-2 py-0.5 bg-slate-700 text-slate-300 rounded text-xs",children:e},s)),e.tags.length>2&&(0,h.jsxs)("span",{className:"px-2 py-0.5 bg-slate-700 text-slate-300 rounded text-xs",children:["+",e.tags.length-2]})]})]})]})},f=({filters:e,onFilterChange:s})=>{const t=(t,a)=>{s({...e,[t]:""===a?void 0:a})},a="w-full bg-slate-800 border border-white/10 rounded-lg px-3 py-2 text-sm text-white focus:border-blue-500 focus:ring-1 focus:ring-blue-500 outline-none transition-colors",l="block text-sm font-medium text-slate-300 mb-1.5",r="relative inline-flex h-6 w-11 items-center rounded-full transition-colors",i="inline-block h-4 w-4 transform rounded-full bg-white transition-transform";return(0,h.jsxs)("div",{className:"glass-card p-5 rounded-xl mb-6",children:[(0,h.jsxs)("div",{className:"flex flex-wrap items-center gap-4 mb-4 pb-4 border-b border-white/10",children:[(0,h.jsxs)("label",{className:"flex items-center gap-3 cursor-pointer",children:[(0,h.jsx)("span",{className:"text-sm text-slate-300",children:"Tamamlananları Gizle"}),(0,h.jsx)("button",{type:"button",onClick:()=>t("hideCompleted",!e.hideCompleted),className:`${r} ${e.hideCompleted?"bg-purple-600":"bg-slate-700"}`,children:(0,h.jsx)("span",{className:`${i} ${e.hideCompleted?"translate-x-6":"translate-x-1"}`})})]}),(0,h.jsxs)("label",{className:"flex items-center gap-3 cursor-pointer",children:[(0,h.jsx)("span",{className:"text-sm text-slate-300",children:"Etiketlere Göre Grupla"}),(0,h.jsx)("button",{type:"button",onClick:()=>t("groupByTag",!e.groupByTag),className:`${r} ${e.groupByTag?"bg-purple-600":"bg-slate-700"}`,children:(0,h.jsx)("span",{className:`${i} ${e.groupByTag?"translate-x-6":"translate-x-1"}`})})]})]}),(0,h.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:l,children:"Durum"}),(0,h.jsxs)("select",{value:e.status||"",onChange:e=>t("status",e.target.value),className:a,children:[(0,h.jsx)("option",{value:"",children:"Tümü"}),(0,h.jsx)("option",{value:"not_started",children:"Başlamadı"}),(0,h.jsx)("option",{value:"in_progress",children:"Devam Ediyor"}),(0,h.jsx)("option",{value:"completed",children:"Tamamlandı"}),(0,h.jsx)("option",{value:"blocked",children:"Engellendi"})]})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:l,children:"Kategori"}),(0,h.jsxs)("select",{value:e.category||"",onChange:e=>t("category",e.target.value),className:a,children:[(0,h.jsx)("option",{value:"",children:"Tümü"}),(0,h.jsx)("option",{value:"routine",children:"Rutin"}),(0,h.jsx)("option",{value:"project",children:"Proje"}),(0,h.jsx)("option",{value:"one_time",children:"Tek Seferlik"}),(0,h.jsx)("option",{value:"issue_resolution",children:"Sorun Çözümü"})]})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:l,children:"Öncelik"}),(0,h.jsxs)("select",{value:e.priority||"",onChange:e=>t("priority",e.target.value),className:a,children:[(0,h.jsx)("option",{value:"",children:"Tümü"}),(0,h.jsx)("option",{value:"low",children:"Düşük"}),(0,h.jsx)("option",{value:"medium",children:"Orta"}),(0,h.jsx)("option",{value:"high",children:"Yüksek"}),(0,h.jsx)("option",{value:"critical",children:"Kritik"})]})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:l,children:"Sırala"}),(0,h.jsxs)("select",{value:e.sort_by||"created_at",onChange:e=>t("sort_by",e.target.value),className:a,children:[(0,h.jsx)("option",{value:"created_at",children:"Oluşturma Tarihi"}),(0,h.jsx)("option",{value:"updated_at",children:"Güncelleme Tarihi"}),(0,h.jsx)("option",{value:"due_date",children:"Bitiş Tarihi"}),(0,h.jsx)("option",{value:"priority",children:"Öncelik"}),(0,h.jsx)("option",{value:"status",children:"Durum"}),(0,h.jsx)("option",{value:"title",children:"Başlık"})]})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:l,children:"Sıralama"}),(0,h.jsxs)("select",{value:e.sort_order||"desc",onChange:e=>t("sort_order",e.target.value),className:a,children:[(0,h.jsx)("option",{value:"desc",children:"Azalan"}),(0,h.jsx)("option",{value:"asc",children:"Artan"})]})]})]}),(0,h.jsx)("div",{className:"mt-4 flex justify-end",children:(0,h.jsx)("button",{onClick:()=>s({hideCompleted:!0}),className:"text-sm text-blue-400 hover:text-blue-300 font-medium transition-colors",children:"Filtreleri Temizle"})})]})},N=()=>{const[e,t]=(0,u.useState)([]),[a,l]=(0,u.useState)(!0),[r,o]=(0,u.useState)(null),[d,m]=(0,u.useState)({sort_by:"created_at",sort_order:"desc",hideCompleted:!0,groupByTag:!0}),x=s();(0,u.useEffect)(()=>{p()},[d]),(0,u.useEffect)(()=>{let e;return(async()=>{const{data:{session:s}}=await n.auth.getSession();s&&(e=n.channel("tasks-realtime").on("postgres_changes",{event:"*",schema:"public",table:"tasks"},e=>{"INSERT"===e.eventType?t(s=>[e.new,...s]):"UPDATE"===e.eventType?t(s=>s.map(s=>s.id===e.new.id?e.new:s)):"DELETE"===e.eventType&&t(s=>s.filter(s=>s.id!==e.old.id))}).subscribe())})(),()=>{e&&n.removeChannel(e)}},[]);const p=async()=>{try{l(!0),o(null);const{data:{session:e}}=await n.auth.getSession();if(!e)return void o("Oturum bulunamadı");const s=new URLSearchParams;d.status&&s.append("status",d.status),d.category&&s.append("category",d.category),d.priority&&s.append("priority",d.priority),d.sort_by&&s.append("sort_by",d.sort_by),d.sort_order&&s.append("sort_order",d.sort_order);const a=await fetch(`https://rapor-sistemi-backend.onrender.com/api/tasks?${s.toString()}`,{headers:{Authorization:`Bearer ${e.access_token}`,"Content-Type":"application/json"}});if(!a.ok)throw new Error("Görevler yüklenemedi");t((await a.json()).data||[])}catch(e){o(e instanceof Error?e.message:"Bir hata oluştu")}finally{l(!1)}},g=e=>{x(`/tasks/${e}`)},j=d.hideCompleted?e.filter(e=>"completed"!==e.status):e;return a?(0,h.jsx)("div",{className:"flex justify-center items-center min-h-[400px]",children:(0,h.jsx)(c,{size:"lg",message:"Görevler yükleniyor..."})}):r?(0,h.jsxs)("div",{className:"glass-card p-6 rounded-xl border-red-500/30",children:[(0,h.jsx)("p",{className:"font-medium text-red-400",children:"Hata"}),(0,h.jsx)("p",{className:"text-sm text-slate-400 mt-1",children:r}),(0,h.jsx)("button",{onClick:p,className:"mt-3 text-sm text-blue-400 hover:text-blue-300 font-medium transition-colors",children:"Tekrar Dene"})]}):(0,h.jsxs)("div",{children:[(0,h.jsx)(f,{filters:d,onFilterChange:m}),(0,h.jsxs)("div",{className:"flex items-center gap-4 mb-4 text-sm text-slate-400",children:[(0,h.jsxs)("span",{children:[j.length," görev"]}),d.hideCompleted&&e.length!==j.length&&(0,h.jsxs)("span",{className:"text-slate-500",children:["(",e.length-j.length," tamamlanan gizlendi)"]})]}),0===j.length?(0,h.jsxs)("div",{className:"glass-card p-10 rounded-xl text-center",children:[(0,h.jsx)("svg",{className:"mx-auto h-12 w-12 text-slate-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,h.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})}),(0,h.jsx)("h3",{className:"mt-3 text-base font-medium text-white",children:"Görev bulunamadı"}),(0,h.jsx)("p",{className:"mt-1 text-sm text-slate-400",children:d.hideCompleted?"Aktif görev yok. Tamamlananları görmek için toggle'ı değiştirin.":"Seçili filtrelere uygun görev bulunmuyor."})]}):d.groupByTag?(0,h.jsx)("div",{className:"space-y-6",children:(e=>{const s={},t="Etiketsiz";return e.forEach(e=>{e.tags&&e.tags.length>0?e.tags.forEach(t=>{s[t]||(s[t]=[]),s[t].push(e)}):(s[t]||(s[t]=[]),s[t].push(e))}),Object.entries(s).sort((e,s)=>s[1].length-e[1].length)})(j).map(([e,s])=>(0,h.jsxs)("div",{className:"space-y-3",children:[(0,h.jsxs)("div",{className:"flex items-center gap-2 sticky top-0 bg-slate-900/80 backdrop-blur-sm py-2 z-10",children:[(0,h.jsx)(i,{className:"w-5 h-5 text-purple-400"}),(0,h.jsx)("h3",{className:"text-lg font-semibold text-white",children:e}),(0,h.jsx)("span",{className:"px-2 py-0.5 bg-purple-500/20 text-purple-300 text-xs rounded-full",children:s.length})]}),(0,h.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:s.map(s=>(0,h.jsx)(b,{task:s,onClick:()=>g(s.id),showAssignee:!0},`${e}-${s.id}`))})]},e))}):(0,h.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:j.map(e=>(0,h.jsx)(b,{task:e,onClick:()=>g(e.id),showAssignee:!0},e.id))})]})},y=()=>{const e=s(),{isAdmin:t}=o();return(0,h.jsx)(m,{children:(0,h.jsxs)("div",{className:"space-y-6",children:[(0,h.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[(0,h.jsxs)("div",{children:[(0,h.jsx)("h1",{className:"text-2xl sm:text-3xl font-bold text-white",children:"Görevler"}),(0,h.jsx)("p",{className:"mt-1 text-slate-400",children:t?"Tüm görevleri yönetin ve atayın":"Kendi görevlerinizi yönetin"})]}),(0,h.jsxs)(x,{onClick:()=>e("/tasks/new"),className:"inline-flex items-center gap-2 px-5 py-2.5 text-sm font-semibold text-white bg-gradient-to-r from-blue-600 to-purple-600 rounded-xl hover:from-blue-500 hover:to-purple-500 hover:shadow-lg hover:shadow-blue-500/25 hover:-translate-y-0.5 transition-all duration-200 [&>svg]:w-5 [&>svg]:h-5",children:[(0,h.jsx)(l,{className:"h-5 w-5"}),t?"Yeni Görev":"Kendime Görev Ekle"]})]}),(0,h.jsx)(N,{})]})})};export{y as Tasks};